<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Forge</title>
    <link rel="website icon" type="png" href="assets/logo.png">

     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
     <style>
        *   {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
    font-family: Arial, sans-serif;
    background: #181818; 
    color: white;
}

#top-bar {
    height: 40px;
    background: linear-gradient(90deg, #1e1e1e, #2c2c2c);
    display: flex;
    align-items: center;
    padding: 0 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    animation: gradientAnimation 5s ease infinite, pulse 2s ease-in-out infinite;
}

@keyframes gradientAnimation {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
}

h2 {
    margin-left: 5px; 
}

h8 {
    margin-left: 5px; 
}
#main-container {
    display: flex;
    padding: 20px;
    gap: 20px;
    background: linear-gradient(145deg, #1e1e1e, #2c2c2c);
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    overflow: hidden;
}

#left-sidebar {
    width: 130px;
    background: #282828;
    padding: 10px;
    overflow-y: auto;
    border-radius: 20px; 
    margin-left: 10px;
    margin-top: 15px;
    margin-right: 10px;
}

#storage-area {
    width: 100%;
    min-height: 100px;
    background: #383838;
    padding: 10px;
    cursor: pointer;
    border-radius: 10px; 
    font-weight: bold ;
    box-shadow: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    transition: background 0.3s , transition 0.3s, box-shadow 0.3s;
}

#storage-area:hover{
    background: #ff8c00;
    box-shadow: 0 0 15px #ff8c00;
}

#left-sidebar button {
    background: #383838;
    border: none;
    color: white;
    padding: 10px 15px;
    margin: 5px 0;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
    border-radius: 5px;
    animation: slideIn 0.5s ease-out;
}

@keyframes slideIn {
    0% { transform: translateX(-100%); opacity: 0; }
    100% { transform: translateX(0); opacity: 1; }
}

#left-sidebar button:hover {
    background: #ff6f00;
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(255, 111, 0, 0.5);
    animation: bounce 0.5s ease;
}

@keyframes bounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.file-card, .text-card {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
    background: #555;
    color: white;
    font-size: 10px;
    border-radius: 10px; 
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.file-card span, .text-card span {
    flex: 1;
    word-break: break-word;
}

.remove-btn {
    background: none;
    border: none;
    color: red;
    font-size: 16px;
    cursor: pointer;
}

#iframe-container {
    flex: 1;
    position: relative;
    width: 100dvw;
    height: 100vh;
    top: 0;
    left: 0;
}

iframe {
    pointer-events: auto;
    z-index: 1;
    position: relative;
    width: 100%;
    height: calc(100vh - 100px);
    border: none;
    border-radius: 10px;
    margin-top: 15px;
    user-select: none;
}

#right-sidebar {
    width: 130px;
    background: #282828;
    padding: 10px;
    overflow-y: auto;
    text-align: center;
    border-radius: 20px; 
    margin-left: 10px;
    margin-top: 15px;
    margin-right: 10px;
}

#right-sidebar button {
    background: #383838;
    border: none;
    color: white;
    padding: 10px 15px;
    margin: 5px 0;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
    border-radius: 5px;
}

#right-sidebar button:hover {
    background: #ff6f00;
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(255, 111, 0, 0.5);
}

.Right-Buttons{
    height: 42px;
    width: 100%;
    white-space: nowrap;
    background: #383838;
    padding: 10px;
    color: white;
    cursor: pointer;
    font-weight: bolder;
    border-radius: 10px; 
    font-weight: bold ;
    box-shadow: none;
    border: none;
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    text-align: center;
    transition: background 0.3s , transition 0.3s, box-shadow 0.3s;
}

.Right-Buttons:nth-child(n+3) {
    margin-top: 10px;
}

.Right-Buttons:hover {
    background: #ff8c00;
    box-shadow: 0 0 15px #ff8c00;
}

#World-edit-box{
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.command-button {
    width: 100%;
    margin-top: 0px;
    margin-bottom: 0px;
    font-size: 14px;
    font-weight: bold;
    padding: 10px;
    background: #383838;
    color: white;
    border: none;
    cursor: pointer;
    z-index: 999;
    border-radius: 0px;
    transition: background 0.3s ease, transform 0.3s ease, padding 0.3s ease , box-shadow 0.3s ease; 
}
.command-button i{
 font-size: 15px;
}

.command-button:hover {
    padding: 15px; 
    z-index: 1000;
    background: #ff8c00;
    box-shadow: 0 0 15px #ff8c00;
    transform: scale(1.05);
    border-radius: 5px;
}

.command-button:nth-child(6){
    border-radius: 0 0 10px 10px;
}

.popup {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: transparent;
    padding: 20px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);
    z-index: 1000;
}
#write-text-area {
    width: 100%;
    min-height: 100px;
    background: #383838;
    padding: 10px;
    cursor: pointer;
    border-radius: 10px; 
    font-weight: bold;
    text-align: center;
    transition: background 0.3s, box-shadow 0.3s;
}
#write-text-area:hover {
    background: #ff8c00;
    box-shadow: 0 0 15px #ff8c00;
}

#Extra-tools-box {
    display: none;
    flex-direction: column;
    background: #383838;
    padding: 10px;
    border-radius: 0 0 10px 10px;
    margin-top: -2px;
    border-top: none;
}

.extra-tool-button {
    width: 100%;
    margin: 5px 0;
    background: #383838;
    border: 2px solid #ff6f00;
    color: white;
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.extra-tool-button i {
    margin-left: 8px;
    font-size: 16px;
}

.extra-tool-button:hover {
    background: #ff6f00;
    color: black;
    transform: translateY(-2px);
    box-shadow: 0 2px 5px rgba(255, 111, 0, 0.3);
}

.popup-container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 500px;
    max-height: 80vh;
    background: #282828;
    padding: 20px;
    border-radius: 10px;
    border: 2px solid #ff6f00;
    box-shadow: 0 4px 8px rgba(255, 111, 0, 0.3);
    z-index: 1000;
    display: flex;
    flex-direction: column;
}

.popup-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.popup-title {
    color: white;
}

.popup-close {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
}

.popup-textarea {
    width: 100%;
    height: 300px;
    background: #383838;
    border: 1px solid #ff6f00;
    padding: 10px;
    border-radius: 5px;
    color: white;
    margin-bottom: 15px;
    resize: none;
}

.buttons-container {
    display: flex;
    gap: 10px;
}

.popup-button {
    flex: 1;
    padding: 10px;
    background: #383838;
    border: 2px solid #ff6f00;
    color: white;
    border-radius: 5px;
    cursor: pointer;
}

.tool-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 500px;
    background: #282828;
    padding: 20px;
    border-radius: 10px;
    border: 2px solid #ff6f00;
    box-shadow: 0 4px 8px rgba(255, 111, 0, 0.3);
    z-index: 1000;
}
.module-card {
    background: rgba(56, 56, 56, 0.9);
    border-radius: 8px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid transparent;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    margin-bottom: 15px;
}

.text-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 500px;
    height: 400px;
    background: #282828;
    padding: 10px;
    z-index: 1000;
    border: 2px solid #ff6f00;
    box-shadow: 0 4px 8px rgba(255, 111, 0, 0.3);
    display: flex;
    flex-direction: column;
    border-radius: 10px;
    color: white;
    animation: fadeInScale 0.3s ease;
}

@keyframes fadeInScale {
    0% { opacity: 0; transform: scale(0.9); }
    100% { opacity: 1; transform: scale(1); }
}
     </style>
</head>
<body>

  <div id="top-bar">
    <img src="assets/logo.png" width="50" height="50">
    <h2>World Forge</h2>
</div>

    <div id="main-container">
        <div id="left-sidebar">
            <div id="storage-area" onclick="document.getElementById('file-input').click();">
                <i class="ri-file-3-line" style="font-size: 30px;"></i>
                <p>Add Files</p>
                <input type="file" id="file-input" style="display: none;" onchange="handleFileUpload(event)">
            </div>

            <div class="file-card" onclick="downloadFile('house.bloxdschem')"></div>
      
                <div id="write-text-area" onclick="openTextEditor()">
                    <i class="ri-edit-2-line" style="font-size: 30px;"></i>
                    <p>Write Text</p>
                </div>
        
                <div id="saved-texts"></div>

        </div>

        <div id="iframe-container">
            <iframe id="game-frame" src="https://bloxd.io" scrolling="no"></iframe>
        </div>

          <div id="text-popup" class="popup">
      <div class="popup-content">
          <input type="text" id="text-title" placeholder="Enter Title">
          <textarea id="text-body" placeholder="Write your text here..."></textarea>
          <button onclick="saveText()">Save</button>
          <button onclick="closeTextPopup()">Close</button>
      </div>
  </div>

  <div id="view-popup" class="popup">
      <div class="popup-content">
          <h3 id="view-title"></h3>
          <p id="view-body"></p>
          <button onclick="closeViewPopup()">Close</button>
      </div>
  </div>

        <div id="right-sidebar">
            <button id="world-edit-btn" class="Right-Buttons" onclick="toggleWEmenu()">World Edit<i class="ri-arrow-left-s-line" style="font-size: 20px;"></i></button>
            <div id="World-edit-box">
            <button class="command-button" onclick="copyCommand('//pos1', this)">Pos 1 <i class="ri-flag-fill"></i></button>
            <button class="command-button" onclick="copyCommand('//pos2', this)">Pos 2 <i class="ri-flag-fill"></i></button>
            <button class="command-button" onclick="copyCommand('//copy', this)">Copy <i class="ri-file-copy-fill"></i></button>
            <button class="command-button" onclick="copyCommand('//paste', this)">Paste <i class="ri-clipboard-fill"></i></button>
            <button class="command-button" onclick="copyCommand('//schematic load', this)">Load <i class="ri-download-cloud-fill"></i></button>
            <button class="command-button" onclick="copyCommand('//schematic save', this)">Save <i class="ri-save-fill"></i></button>
        </div>
        <button id="extra-tools-btn" class="Right-Buttons" onclick="toggleExtraTools()">Extra Tools<i class="ri-arrow-left-s-line" style="font-size: 20px;"></i></button>
        <div id="Extra-tools-box">
          <button class="extra-tool-button" onclick="showCircleWallToolPopup()">Circle Wall Tool</button>
          <button class="extra-tool-button" onclick="showTreeToolPopup()">Auto Tree Tool</button>
          <button class="extra-tool-button" onclick="showSphereToolPopup()">Sphere Tool</button>
      </div>
        <button class="Right-Buttons" id="first-child" onclick="createSign()">
            Create Sign <i class="ri-signpost-fill" style="margin-left: 8px;"></i>
        </button>        
                <button class="Right-Buttons" onclick="createPlaceholderSign()">
                    Find builds <i class="fa fa-shopping-cart" style="margin-left: 8px;"></i>
                </button>

        </div>
    </div>

    <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; z-index: 1000;">
        <img src="assets/your-image.png" alt="Click-through Image" style="width: 200px; height: auto;">
    </div>

</body>
</html>
<script>
    let writeTextArea = document.getElementById("write-text-area");
writeTextArea.onclick = openTextEditor;

function openTextEditor() {
    let textEditor = document.createElement("div");
    textEditor.id = "text-editor";
    textEditor.style.position = "fixed";
    textEditor.style.top = "50%";
    textEditor.style.left = "50%";
    textEditor.style.transform = "translate(-50%, -50%)";
    textEditor.style.width = "500px";
    textEditor.style.background = "#282828";
    textEditor.style.padding = "10px";
    textEditor.style.zIndex = "1000";
    textEditor.style.border = "2px solid #ff6f00";
    textEditor.style.boxShadow = "0 4px 8px rgba(0, 0, 0, 0.3)";
    textEditor.style.color = "white";
    textEditor.style.borderRadius = "10px";

    let header = document.createElement("div");
    header.style.backgroundColor = "#383838";
    header.style.color = "white";
    header.style.padding = "10px";
    header.style.display = "flex";
    header.style.justifyContent = "space-between";
    header.style.alignItems = "center";
    header.style.borderBottom = "2px solid #ff6f00";
    header.style.borderRadius = "10px 10px 0 0";

    let headerTitle = document.createElement("span");
    headerTitle.textContent = "Text Editor";
    headerTitle.style.fontWeight = "bold";
    header.appendChild(headerTitle);

    let closeButton = document.createElement("button");
    closeButton.innerHTML = "×";
    closeButton.style.background = "none";
    closeButton.style.border = "none";
    closeButton.style.color = "white";
    closeButton.style.fontSize = "20px";
    closeButton.style.cursor = "pointer";
    closeButton.style.transition = "color 0.3s ease";
    closeButton.onmouseover = function() { this.style.color = "#ff6f00"; };
    closeButton.onmouseout = function() { this.style.color = "white"; };
    closeButton.onclick = () => textEditor.remove();
    header.appendChild(closeButton);

    textEditor.appendChild(header);

    let contentContainer = document.createElement("div");
    contentContainer.style.padding = "10px";

    let titleInput = document.createElement("input");
    titleInput.type = "text";
    titleInput.placeholder = "Enter title";
    titleInput.style.width = "100%";
    titleInput.style.marginBottom = "10px";
    titleInput.style.background = "#383838";
    titleInput.style.border = "1px solid #ff6f00";
    titleInput.style.padding = "8px";
    titleInput.style.borderRadius = "4px";
    titleInput.style.color = "white";
    
    let textInput = document.createElement("textarea");
    textInput.placeholder = "Write your text here...";
    textInput.style.width = "100%";
    textInput.style.minHeight ="300px";
    textInput.style.marginBottom = "10px";
    textInput.style.background = "#383838";
    textInput.style.border = "1px solid #ff6f00";
    textInput.style.padding = "8px";
    textInput.style.borderRadius = "4px";
    textInput.style.resize = "vertical";
    textInput.style.color = "white";

    let saveButton = document.createElement("button");
    saveButton.innerText = "Save";
    saveButton.style.width = "100%";
    saveButton.style.background = "#383838";
    saveButton.style.border = "2px solid #ff6f00";
    saveButton.style.padding = "10px 20px";
    saveButton.style.cursor = "pointer";
    saveButton.style.borderRadius = "8px";
    saveButton.style.color = "white";
    saveButton.style.fontSize = "14px";
    saveButton.style.transition = "background 0.3s ease, color 0.3s ease";
    saveButton.onmouseover = function() { 
        this.style.background = "#ff6f00"; 
        this.style.color = "black";
    };
    saveButton.onmouseout = function() { 
        this.style.background = "#383838"; 
        this.style.color = "white";
    };
    saveButton.onclick = () => saveText(titleInput.value, textInput.value, textEditor);

    contentContainer.appendChild(titleInput);
    contentContainer.appendChild(textInput);
    contentContainer.appendChild(saveButton);

    textEditor.appendChild(contentContainer);
    document.body.appendChild(textEditor);
}

function openSavedText(item) {
    let textPopup = document.createElement("div");
    textPopup.style.position = "fixed";
    textPopup.style.top = "50%";
    textPopup.style.left = "50%";
    textPopup.style.transform = "translate(-50%, -50%)";
    textPopup.style.width = "500px";
    textPopup.style.height = "400px";
    textPopup.style.background = "#282828";
    textPopup.style.padding = "10px";
    textPopup.style.zIndex = "1000";
    textPopup.style.border = "2px solid #ff6f00";
    textPopup.style.boxShadow = "0 4px 8px rgba(255, 111, 0, 0.3)";
    textPopup.style.display = "flex";
    textPopup.style.flexDirection = "column";
    textPopup.style.borderRadius = "10px";
    textPopup.style.color = "white";

    let header = document.createElement("div");
    header.style.backgroundColor = "#383838";
    header.style.color = "white";
    header.style.padding = "10px";
    header.style.display = "flex";
    header.style.justifyContent = "space-between";
    header.style.alignItems = "center";
    header.style.borderBottom = "2px solid #ff6f00";
    header.style.borderRadius = "10px 10px 0 0";

    let headerTitle = document.createElement("span");
    headerTitle.innerText = item.title;
    headerTitle.style.fontWeight = "bold";
    header.appendChild(headerTitle);

    let closeButton = document.createElement("button");
    closeButton.innerHTML = "×";
    closeButton.style.background = "none";
    closeButton.style.border = "none";
    closeButton.style.color = "white";
    closeButton.style.fontSize = "20px";
    closeButton.style.cursor = "pointer";
    closeButton.style.transition = "color 0.3s ease";
    closeButton.onmouseover = function() { this.style.color = "#ff6f00"; };
    closeButton.onmouseout = function() { this.style.color = "white"; };
    closeButton.onclick = () => textPopup.remove();
    header.appendChild(closeButton);

    textPopup.appendChild(header);
    
    let contentContainer = document.createElement("div");
    contentContainer.style.padding = "10px";
    contentContainer.style.flexGrow = "1";
    contentContainer.style.overflowY = "auto";

    let content = document.createElement("p");
    content.innerText = item.text;
    content.style.marginBottom = "10px";
    
    let closeBtn = document.createElement("button");
    closeBtn.innerText = "Close";
    closeBtn.style.width = "100%";
    closeBtn.style.background = "#383838";
    closeBtn.style.border = "2px solid #ff6f00";
    closeBtn.style.padding = "10px 20px";
    closeBtn.style.cursor = "pointer";
    closeBtn.style.borderRadius = "8px";
    closeBtn.style.color = "white";
    closeBtn.style.fontSize = "14px";
    closeBtn.style.transition = "background 0.3s ease, color 0.3s ease";
    closeBtn.onmouseover = function() { 
        this.style.background = "#ff6f00"; 
        this.style.color = "black";
    };
    closeBtn.onmouseout = function() { 
        this.style.background = "#383838"; 
        this.style.color = "white";
    };
    closeBtn.onclick = () => textPopup.remove();
    
    contentContainer.appendChild(content);
    contentContainer.appendChild(closeBtn);

    textPopup.appendChild(contentContainer);
    document.body.appendChild(textPopup);
}

function saveText(title, text, editor) {
    if (!title || !text) return;
    let texts = JSON.parse(localStorage.getItem("savedTexts")) || [];
    texts.push({ title, text });
    localStorage.setItem("savedTexts", JSON.stringify(texts));
    displaySavedTexts();
    editor.remove();
}

function displaySavedTexts() {
    let writeTextArea = document.getElementById("write-text-area");

    const existingTextCards = writeTextArea.querySelectorAll(".file-card-wrapper");
    existingTextCards.forEach(card => card.remove());

    let texts = JSON.parse(localStorage.getItem("savedTexts")) || [];
    texts.forEach((item, index) => {
        const fileCardWrapper = document.createElement("div");
        fileCardWrapper.classList.add("file-card-wrapper");
        const fileCard = document.createElement("div");
        fileCard.classList.add("file-card");

        const displayTextTitle = item.title.length > 10 ? item.title.substring(0, 10) + "..." : item.title;
        fileCard.textContent = displayTextTitle;
        fileCard.onclick = (event) => {
            event.stopPropagation();
            openSavedText(item); 
        };

        const removeBtn = document.createElement("button");
        removeBtn.classList.add("remove-btn");

        const removeIcon = document.createElement("i");
        removeIcon.classList.add("ri-delete-bin-line");
        
        removeBtn.textContent = "Remove ";
        removeBtn.appendChild(removeIcon); 
        removeBtn.onclick = (event) => {

            event.stopPropagation();
            removeSavedText(index);
        };

        fileCardWrapper.appendChild(fileCard);
        fileCardWrapper.appendChild(removeBtn);

        writeTextArea.appendChild(fileCardWrapper);
    });
}

function removeSavedText(index) {
    let texts = JSON.parse(localStorage.getItem("savedTexts")) || [];
    texts.splice(index, 1);
    localStorage.setItem("savedTexts", JSON.stringify(texts));
    displaySavedTexts(); 
}

displaySavedTexts();
           function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const fileName = file.name;
                const fileURL = URL.createObjectURL(file);
                addFileCard(fileName, fileURL);
                saveFileToLocalStorage(fileName, fileURL);
            }
        }
        function addFileCard(fileName, fileURL) {
            let storageArea = document.querySelector("#storage-area");
            
            const cardContainer = document.createElement("div");
            cardContainer.classList.add("file-card-wrapper");
            
            const fileCard = document.createElement("div");
            fileCard.classList.add("file-card");
            
            const displayFileName = fileName.length > 13 ? fileName.substring(0, 13) + "..." : fileName;
            fileCard.textContent = displayFileName;
            fileCard.onclick = (e) => {
                e.stopPropagation();
                downloadFile(fileURL);
            };

            const removeBtn = document.createElement("button");
            removeBtn.classList.add("remove-btn");
            const removeIcon = document.createElement("i");
            removeIcon.classList.add("ri-delete-bin-line");
            removeBtn.textContent = "Remove ";
            removeBtn.appendChild(removeIcon);
            removeBtn.onclick = (e) => {
                e.stopPropagation();
                confirmRemove(e, fileName, cardContainer);
            };

            cardContainer.appendChild(fileCard);
            cardContainer.appendChild(removeBtn);
            storageArea.appendChild(cardContainer);
        }
        
        function confirmRemove(event, fileName, fileCardWrapper) {
            event.stopPropagation();
        
            const confirmation = confirm(`Are you sure you want to remove ${fileName}?`);
            if (confirmation) {
                removeFileFromLocalStorage(fileName);
                fileCardWrapper.remove();
            }
        }
        
        function saveFileToLocalStorage(fileName, fileURL) {
            const files = JSON.parse(localStorage.getItem("uploadedFiles")) || [];
            files.push({ fileName, fileURL });
            localStorage.setItem("uploadedFiles", JSON.stringify(files));
        }

        function removeFileFromLocalStorage(fileName) {
            const files = JSON.parse(localStorage.getItem("uploadedFiles")) || [];
            const updatedFiles = files.filter(file => file.fileName !== fileName);
            localStorage.setItem("uploadedFiles", JSON.stringify(updatedFiles));
        }

        function loadSavedFiles() {
            const files = JSON.parse(localStorage.getItem("uploadedFiles")) || [];
            files.forEach(file => addFileCard(file.fileName, file.fileURL));
        }

        function downloadFile(file) {
            const a = document.createElement("a");
            a.href = file;
            a.download = file;
            a.click();
        }

        window.onload = loadSavedFiles;

        function copyCommand(command, button) {
            const originalText = button.innerHTML;
            navigator.clipboard.writeText(command).then(() => {
                button.innerHTML = 'Copied!';
                setTimeout(() => {
                    button.innerHTML = originalText;
                }, 1000);
            }).catch((error) => {
                button.innerHTML = 'Failed to copy';
                setTimeout(() => {
                    button.innerHTML = originalText;
                }, 1000);
                console.error("Error copying text: ", error);
            });
        }

        let resizeHandle, iframeContainer, startX, startY, startWidth, startHeight;

        function createResizeHandle() {
            resizeHandle = document.createElement('div');
            resizeHandle.className = 'resize-handle';
            iframeContainer.appendChild(resizeHandle);
            resizeHandle.addEventListener('mousedown', initResize);
        }

        function initResize(e) {
            e.preventDefault();
            e.stopPropagation();
            iframeContainer = document.getElementById('iframe-sign-container');
            const computedStyle = window.getComputedStyle(iframeContainer);
            startWidth = parseInt(computedStyle.width, 10);
            startHeight = parseInt(computedStyle.height, 10);
            startX = e.clientX;
            startY = e.clientY;
            document.addEventListener('mousemove', performResize);
            document.addEventListener('mouseup', stopResize);
            iframeContainer.classList.add('resizing');
        }

        function performResize(e) {
            if (!iframeContainer) return;
            const deltaX = e.clientX - startX;
            const deltaY = e.clientY - startY;
            const newWidth = Math.max(300, Math.min(startWidth + deltaX, window.innerWidth * 0.9));
            const newHeight = Math.max(200, Math.min(startHeight + deltaY, window.innerHeight * 0.9));
            requestAnimationFrame(() => {
                iframeContainer.style.width = `${newWidth}px`;
                iframeContainer.style.height = `${newHeight}px`;
            });
        }

        function stopResize() {
            document.removeEventListener('mousemove', performResize);
            document.removeEventListener('mouseup', stopResize);

            if (iframeContainer) {
                iframeContainer.classList.remove('resizing');
            }

            startX = null;
            startY = null;
            startWidth = null;
            startHeight = null;
        }

        function initResizeFeature() {
            iframeContainer = document.getElementById('iframe-sign-container');
            if (iframeContainer && !iframeContainer.querySelector('.resize-handle')) {
                createResizeHandle();
            }
        }

        function createSign() {
            const popupContent = `
                <div class="popup-header">
                    <h3 class="popup-title">Sign Editor</h3>
                    <button class="popup-close">×</button>
                </div>
                <iframe src="assets/sign.html" style="width: 100%; height: calc(100% - 60px); border: none;"></iframe>
            `;

            const popup = document.createElement("div");
            popup.className = "popup-container";
            popup.style.width = "600px";
            popup.style.height = "80vh";
            popup.innerHTML = popupContent;

            popup.querySelector(".popup-close").onclick = () => popup.remove();
            document.body.appendChild(popup);

            makePopupDraggable(popup);
        }

        function createPlaceholderSign() {
            const popupContent = `
                <div class="popup-header">
                    <h3 class="popup-title">Forged Builds</h3>
                    <button class="popup-close">×</button>
                </div>
                <iframe src="/app/assets/5page.html" style="width: 100%; height: calc(100% - 60px); border: none;"></iframe>
            `;

            const popup = document.createElement("div");
            popup.className = "popup-container";
            popup.style.width = "70%";
            popup.style.height = "80vh";
            popup.innerHTML = popupContent;

            popup.querySelector(".popup-close").onclick = () => popup.remove();
            document.body.appendChild(popup);

            makePopupDraggable(popup);
        }

        function makePopupDraggable(popup) {
            const header = popup.querySelector(".popup-header");
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;

            header.onmousedown = dragStart;
            document.onmouseup = dragEnd;
            document.onmousemove = drag;

            function dragStart(e) {
                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;
                if (e.target === header || e.target.parentElement === header) {
                    isDragging = true;
                }
            }

            function dragEnd() {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    xOffset = currentX;
                    yOffset = currentY;
                    popup.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
            }
        }

        window.createPlaceholderSign = createPlaceholderSign;

        function toggleWEmenu() {
            let WEicon = document.querySelector("#world-edit-btn i");
            let WEMENU = document.getElementById("World-edit-box");
            let WEbutton = document.getElementById("world-edit-btn");
          
            if (WEicon.classList.contains("ri-arrow-left-s-line")) {
                WEicon.classList.remove("ri-arrow-left-s-line");
                WEicon.classList.add("ri-arrow-down-s-line");

                WEbutton.style.borderRadius ="10px 10px 0 0";
                WEMENU.style.display = "flex";
            } else {
                WEicon.classList.remove("ri-arrow-down-s-line");
                WEicon.classList.add("ri-arrow-left-s-line");

                WEbutton.style.borderRadius ="10px";
                WEMENU.style.display = "none";
            }
        }

        function toggleExtraTools() {
        let extraToolsIcon = document.querySelector("#extra-tools-btn i");
        let extraToolsMenu = document.getElementById("Extra-tools-box");
        let extraToolsButton = document.getElementById("extra-tools-btn");
      
        if (extraToolsIcon.classList.contains("ri-arrow-left-s-line")) {
            extraToolsIcon.classList.remove("ri-arrow-left-s-line");
            extraToolsIcon.classList.add("ri-arrow-down-s-line");
            extraToolsButton.style.borderRadius = "10px 10px 0 0";
            extraToolsMenu.style.display = "flex";
        } else {
            extraToolsIcon.classList.remove("ri-arrow-down-s-line");
            extraToolsIcon.classList.add("ri-arrow-left-s-line");
            extraToolsButton.style.borderRadius = "10px";
            extraToolsMenu.style.display = "none";
        }
    }
    
    function showCircleWallToolPopup() {
    showToolPopup("Circle Tool", `
const block1 = api.getHeldItem(myId).name;
const block2 = api.getItemSlot(myId, 0).name;
const decideBlock = ()=>(Math.random()>0.5 ? block1:block2);
const radius = api.getHeldItem(myId).amount
const hight = api.getInventoryItemAmount(myId, "Updraft")
const x = thisPos[0], y = thisPos[1], z = thisPos[2]

for(let countX = 0, countZ = 0; x-radius+countX < x; countZ ++){
api.setBlockRect([x-radius+countX, y, z+countZ], [x-radius+countX, y+hight, z+countZ], decideBlock())
while((-radius+countX) ** 2 + countZ ** 2 > radius ** 2){countX ++;
api.setBlockRect([x-radius+countX, y, z+countZ], [x-radius+countX, y+hight, z+countZ], decideBlock())}}

for(let countX = 0, countZ = 0; x+radius-countX > x; countZ ++){
api.setBlockRect([x+radius-countX, y, z-countZ], [x+radius-countX, y+hight, z-countZ], decideBlock())
while((radius-countX) ** 2 + countZ ** 2 > radius ** 2){countX ++;
api.setBlockRect([x+radius-countX, y, z-countZ], [x+radius-countX, y+hight, z-countZ], decideBlock())}}

for(let countX = 0 ,countZ = 0; z+radius-countZ > z; countX ++){
api.setBlockRect([x+countX, y, z+radius-countZ], [x+countX, y+hight, z+radius-countZ], decideBlock())
while(countX ** 2 + (radius-countZ) ** 2 > radius ** 2){countZ ++;
api.setBlockRect([x+countX, y, z+radius-countZ], [x+countX, y+hight, z+radius-countZ], decideBlock())}}

for(let countX = 0 ,countZ = 0; z-radius+countZ < z; countX ++){
api.setBlockRect([x-countX, y, z-radius+countZ], [x-countX, y+hight, z-radius+countZ], decideBlock())
while(countX ** 2 + (-radius+countZ) ** 2 > radius ** 2){countZ ++;
api.setBlockRect([x-countX, y, z-radius+countZ], [x-countX, y+hight, z-radius+countZ], decideBlock())}}
    `);
}

function showTreeToolPopup() {
    showToolPopup("Tree Tool", `
const trunkBlock = "Pine Log";
const leavesBlock = "Pine Leaves";

let height = 20 + Math.floor(Math.random() * 6);
let radius = 4;

const [x, y, z] = thisPos;

for (let dy = 0; dy < height; dy++) {
    api.setBlock([x, y + dy, z], trunkBlock);
}

for (let dy = 3; dy < height - 2; dy += 3) {  
    let layerRadius = Math.ceil(radius * (1 - dy / height)) + 1; 

    for (let dx = -layerRadius; dx <= layerRadius; dx++) {
        for (let dz = -layerRadius; dz <= layerRadius; dz++) {
            let distSq = dx * dx + dz * dz;
            let maxDistSq = layerRadius * layerRadius;

            if (distSq <= maxDistSq && !(dx === 0 && dz === 0) && Math.random() > 0.3) { 
                api.setBlock([x + dx, y + dy, z + dz], leavesBlock);
            }
        }
    }
}

for (let dy = -1; dy < 3; dy++) { 
    let topRadius = Math.max(1, Math.ceil((radius / 2) * (1 - (dy + 1) / 4))); 

    for (let dx = -topRadius; dx <= topRadius; dx++) {
        for (let dz = -topRadius; dz <= topRadius; dz++) {
            let distSq = dx * dx + dz * dz;
            let maxDistSq = topRadius * topRadius;

            if (distSq <= maxDistSq && Math.random() > (0.4 + (dy + 1) * 0.1)) { 
                api.setBlock([x + dx, y + height + dy, z + dz], leavesBlock);
            }
        }
    }
}

if (Math.random() > 0.5) { 
    api.setBlock([x, y + height + 3, z], leavesBlock);
}
    `);
}

function showSphereToolPopup() {
    showToolPopup("Triangle Tool", `
const maxRadius = api.getHeldItem(myId).amount, [x, y, z] = thisPos
let block = api.getHeldItem(myId).name

if(block == "Protector") block = "Water"
if(block == "Tribe Protector") block = "Lava"

function circle(countY, radius){
for(let countX = 0, countZ = 0; x-radius+countX < x; countZ ++){
api.setBlock(x-radius+countX, y+countY, z+countZ, block)
while((-radius+countX) ** 2 + countZ ** 2 > radius ** 2){countX ++;
api.setBlock(x-radius+countX, y+countY, z+countZ, block)}}

for(let countX = 0, countZ = 0; x+radius-countX > x; countZ ++){
api.setBlock(x+radius-countX, y+countY, z-countZ, block)
while((radius-countX) ** 2 + countZ ** 2 > radius ** 2){countX ++;
api.setBlock(x+radius-countX, y+countY, z-countZ, block)}}

for(let countX = 0 ,countZ = 0; z+radius-countZ > z; countX ++){
api.setBlock(x+countX, y+countY, z+radius-countZ, block)
while(countX ** 2 + (radius-countZ) ** 2 > radius ** 2){countZ ++;
api.setBlock(x+countX, y+countY, z+radius-countZ, block)}}

for(let countX = 0 ,countZ = 0; z-radius+countZ < z; countX ++){
api.setBlock(x-countX, y+countY, z-radius+countZ, block)
while(countX ** 2 + (-radius+countZ) ** 2 > radius ** 2){countZ ++;
api.setBlock(x-countX, y+countY, z-radius+countZ, block)}}}

for(let countY = 0, radius = maxRadius; radius > 0; countY ++){
circle(countY, radius)
while((-radius) ** 2 + countY ** 2 > maxRadius ** 2){radius --;
circle(countY, radius)}}

for(let countY = 0, radius = maxRadius; radius > 0; countY --){
circle(countY, radius)
while((-radius) ** 2 + countY ** 2 > maxRadius ** 2){radius --;
circle(countY, radius)}}
    `);
}

function showToolPopup(toolName, content) {
    let popup = document.createElement("div");
    popup.className = "popup-container";

    let header = document.createElement("div");
    header.className = "popup-header";

    let title = document.createElement("h3");
    title.className = "popup-title";
    title.textContent = toolName + " Code";
    header.appendChild(title);

    let closeBtn = document.createElement("button");
    closeBtn.className = "popup-close";
    closeBtn.innerHTML = "×";
    closeBtn.onclick = () => popup.remove();
    header.appendChild(closeBtn);

    let textarea = document.createElement("textarea");
    textarea.className = "popup-textarea";
    textarea.value = content;

    let buttonsContainer = document.createElement("div");
    buttonsContainer.className = "buttons-container";

    let copyBtn = document.createElement("button");
    copyBtn.className = "popup-button";
    copyBtn.textContent = "Copy Text";
    copyBtn.onclick = () => {
        textarea.select();
        document.execCommand("copy");
    };
    buttonsContainer.appendChild(copyBtn);

    let closeButton = document.createElement("button");
    closeButton.className = "popup-button";
    closeButton.textContent = "Close";
    closeButton.onclick = () => popup.remove();
    buttonsContainer.appendChild(closeButton);

    popup.appendChild(header);
    popup.appendChild(textarea);
    popup.appendChild(buttonsContainer);
    document.body.appendChild(popup);
}
</script>
