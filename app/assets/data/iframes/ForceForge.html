<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ForceForge coder</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    html,
    body {
      margin: 0;
      height: 100%;
      background: #141313;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #e0e0e0;
      overflow: hidden;
      box-sizing: border-box;
    }

    *,
    *:before,
    *:after {
      box-sizing: inherit;
    }

    .container {
      display: flex;
      height: 100vh;
      padding: 20px;
      gap: 20px;
      justify-content: space-between;
      align-items: stretch;
      background: radial-gradient(circle at top right, #1e1c1c, #141313);
      transition: all 0.3s ease;
      box-sizing: border-box;
    }

    .container.pro-layout {
      gap: 20px;
      justify-content: flex-start;
    }

    .container.pro-layout iframe {
      margin-right: 0 !important;
      flex: 1;
      width: calc(100% - 30vh - 20px);
    }

    .sidebar {
      background: linear-gradient(180deg, #1b1a1a 0%, #191818 100%);
      border: 1px solid #2c2b2b;
      border-radius: 35px;
      padding: 24px 20px;
      width: 30vh;
      display: flex;
      flex-direction: column;
      height: 100%;
      flex-shrink: 0;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .sidebar>div:first-child {
      flex: 1;
      overflow-y: auto;
    }

    .bottom-section {
      border-top: 1px solid #2c2b2b;
      padding-top: 20px;
      flex-shrink: 0;
      margin-top: auto;
    }

    .right-sidebar {
      padding: 0;
      overflow: hidden;
      width: 20vh !important;
    }

    .right-sidebar iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 25px;
    }

    .sidebar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, #ff6b3944, transparent);
    }

    .logo {
      text-align: center;
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 1px solid #2c2b2b;
    }

    .logo h1 {
      font-size: 1.8rem;
      margin: 0;
      background: linear-gradient(45deg, #ff6b39, #ff8c5a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    .logo span {
      color: #a0a0a0;
      font-size: 0.8rem;
      letter-spacing: 1px;
    }

    .cards {
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow-y: auto;
      padding: 5px;
    }

    .cards::-webkit-scrollbar {
      width: 4px;
    }

    .cards::-webkit-scrollbar-thumb {
      background: #ff6b39;
      border-radius: 10px;
    }

    .card {
      background: linear-gradient(90deg, #262525 0%, #242323 100%);
      border: 1px solid #3a3939;
      padding: 16px 20px;
      border-radius: 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 80px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .card:hover::before {
      left: 100%;
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 7px 15px rgba(0, 0, 0, 0.2);
      border-color: #4a4949;
    }

    .card-title {
      font-size: 1.1rem;
      color: #e8e8e8;
      font-weight: 500;
      z-index: 1;
    }

    .card-icon {
      width: 50px;
      height: 50px;
      background: rgba(255, 107, 57, 0.1);
      border-radius: 14px;
      margin-left: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.6rem;
      color: #ff6b39;
      z-index: 1;
    }

    .bottom-section {
      border-top: 1px solid #2c2b2b;
      padding-top: 20px;
    }

    .bottom-buttons {
      display: flex;
      gap: 12px;
      margin-top: 10px;
    }

    .cube-btn {
      width: 70px;
      height: 70px;
      background: linear-gradient(145deg, #262525, #212020);
      border: 1px solid #444343;
      border-radius: 18px;
      font-size: 1.6rem;
      font-weight: bold;
      line-height: 0;
      color: #ff6b39;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: linear-gradient(180deg, #1b1a1a 0%, #191818 100%);
      border: 1px solid #2c2b2b;
      border-radius: 35px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .msg {
      max-width: 75%;
      padding: 15px 20px;
      border-radius: 20px;
      line-height: 1.5;
    }

    .msg.user {
      align-self: flex-end;
      background: linear-gradient(90deg, #ff6b39, #ff8c5a);
      color: #141313;
      border-bottom-right-radius: 5px;
    }

    .msg.ai {
      align-self: flex-start;
      background: linear-gradient(90deg, #262525, #212020);
      border: 1px solid #3a3939;
      border-bottom-left-radius: 5px;
    }

    .msg.ai.thinking {
      position: relative;
      overflow: hidden;
    }

    .msg.ai.thinking::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 107, 57, 0.4), transparent);
      animation: shine 2s infinite;
      z-index: 1;
    }

    @keyframes shine {
      0% {
        left: -50%;
      }

      100% {
        left: 150%;
      }
    }

    .composer {
      display: flex;
      gap: 15px;
      padding: 20px 0 10px;
      border-top: 1px solid #2c2b2b;
    }

    textarea#input {
      flex: 1;
      min-height: 60px;
      border-radius: 20px;
      border: 1px solid #3a3939;
      padding: 15px 20px;
      background: linear-gradient(90deg, #262525, #212020);
      color: #e0e0e0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 1rem;
      resize: none;
    }

    button#send {
      background: linear-gradient(45deg, #ff6b39, #ff8c5a);
      border: none;
      padding: 0 25px;
      border-radius: 20px;
      cursor: pointer;
      color: #141313;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    button#send:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 107, 57, 0.4);
    }

    .file-item {
      padding: 12px 15px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.03);
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid #3a3939;
    }

    .btn-ghost {
      background: transparent;
      color: #a0a0a0;
      border: 1px solid #3a3939;
      padding: 8px 15px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-ghost:hover {
      background: rgba(255, 107, 57, 0.1);
      color: #ff6b39;
    }

    .md-view {
      background: linear-gradient(90deg, #262525, #212020);
      border: 1px solid #3a3939;
      border-radius: 18px;
      padding: 15px;
      margin-top: 15px;
      max-height: 200px;
      overflow-y: auto;
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .small {
      color: #a0a0a0;
      font-size: 0.85rem;
    }

    footer {
      text-align: center;
      padding-top: 15px;
      color: #a0a0a0;
      font-size: 0.8rem;
    }

    .hidden {
      display: none;
    }

    .code-block {
      background: #1e1e1e;
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
      border: 1px solid #3a3939;
      overflow-x: auto;
      font-family: 'Consolas', 'Courier New', monospace;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .code-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 5px;
      border-bottom: 1px solid #3a3939;
    }

    .code-lang {
      color: #ff6b39;
      font-weight: bold;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .copy-btn {
      background: rgba(255, 107, 57, 0.2);
      border: none;
      color: #ff6b39;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .copy-btn:hover {
      background: rgba(255, 107, 57, 0.3);
    }

    .code-content {
      white-space: pre;
    }

    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .status-loaded {
      background: rgba(46, 204, 113, 0.2);
      color: #2ecc71;
    }

    .status-loading {
      background: rgba(241, 196, 15, 0.2);
      color: #f1c40f;
    }

    .file-count {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: rgba(52, 152, 219, 0.2);
      color: #3498db;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="chat-container">
      <div class="messages" id="messages"></div>
      <div class="composer">
        <textarea id="input" placeholder="Ask the assistant..."></textarea>
        <button id="send"><i class="fas fa-paper-plane"></i> Send</button>
      </div>
    </div>

    <div class="sidebar">
      <div>
        <div class="cards">
          <div class="card" id="runExample">
            <div class="card-title"> Example Question</div>
            <div class="card-icon"><i class="fas fa-question"></i></div>
          </div>

          <div class="card" id="clearChat">
            <div class="card-title"> Clear Chat</div>
            <div class="card-icon"><i class="fas fa-trash"></i></div>
          </div>
        </div>
      </div>

      <div class="bottom-section">
        <div class="file-item">
          <div><i class="fas fa-database"></i> Context Status</div>
          <div id="status" class="status-indicator status-loaded"><i class="fas fa-check-circle"></i> Loaded</div>
        </div>

        <div style="margin-top: 15px; text-align: center;">
        </div>
      </div>
    </div>
  </div>

  <script src="https://js.puter.com/v2/"></script>
  <script>
    const input = document.getElementById('input');
    const send = document.getElementById('send');
    const messages = document.getElementById('messages');
    const fileCount = document.getElementById('fileCount');
    const runExampleBtn = document.getElementById('runExample');
    const clearChatBtn = document.getElementById('clearChat');
    const reloadContextBtn = document.getElementById('reloadContext');
    const statusIndicator = document.getElementById('status');

    const docs = [];

    const extraInfo = `Application Context:
You are ForceForge coder, your job is to help the user with coding with the bloxd.io api.
Do not use markdown, Try to give the best code. try to Talk less but give a short overview of what you are going to do.
make sure to give the code in one code block.
`;

    async function loadMarkdownFiles() {
      statusIndicator.className = 'status-indicator status-loading';
      statusIndicator.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading';

      const fileNames = [
        'md/CALLBACKS.md',
        'md/CLIENT_OPTIONS.md',
        'md/ENTITY_SETTINGS.md',
        'md/MOB_SETTINGS.md',
        'md/EXTRA.md',
        'md/PARTICLES.md'
      ];

      docs.length = 0;

      for (const fileName of fileNames) {
        try {
          const response = await fetch(fileName);
          if (response.ok) {
            const text = await response.text();
            docs.push({
              name: fileName.split('/').pop(),
              text: text
            });
          } else {
            console.warn(`Failed to load ${fileName}: ${response.status}`);
          }
        } catch (err) {
          console.error(`Error loading ${fileName}:`, err);
        }
      }

      statusIndicator.className = 'status-indicator status-loaded';
      statusIndicator.innerHTML = '<i class="fas fa-check-circle"></i> Loaded';
      fileCount.innerHTML = '<i class="fas fa-file-alt"></i> ' + `${docs.length} files`;
    }

    loadMarkdownFiles();

    function createCodeBlock(code, language = 'javascript') {
      const codeBlock = document.createElement('div');
      codeBlock.className = 'code-block';

      const header = document.createElement('div');
      header.className = 'code-header';

      const langSpan = document.createElement('span');
      langSpan.className = 'code-lang';

      let langIcon = 'fas fa-code';
      if (language === 'javascript' || language === 'js') langIcon = 'fab fa-js';
      else if (language === 'typescript' || language === 'ts') langIcon = 'fab fa-js';
      else if (language === 'python' || language === 'py') langIcon = 'fab fa-python';
      else if (language === 'html') langIcon = 'fab fa-html5';
      else if (language === 'css') langIcon = 'fab fa-css3';
      else if (language === 'json') langIcon = 'fas fa-brackets-curly';

      langSpan.innerHTML = `<i class="${langIcon}"></i> ${language}`;

      const copyBtn = document.createElement('button');
      copyBtn.className = 'copy-btn';
      copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copy';
      copyBtn.onclick = () => {
        navigator.clipboard.writeText(code);
        const originalText = copyBtn.innerHTML;
        copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
        setTimeout(() => {
          copyBtn.innerHTML = originalText;
        }, 2000);
      };

      header.appendChild(langSpan);
      header.appendChild(copyBtn);

      const content = document.createElement('div');
      content.className = 'code-content';
      content.textContent = code;

      codeBlock.appendChild(header);
      codeBlock.appendChild(content);

      return codeBlock;
    }

    function formatMessage(text) {
      const codeBlockRegex = /```(\w+)?\n([\s\S]*?)```/g;
      const parts = [];
      let lastIndex = 0;
      let match;

      while ((match = codeBlockRegex.exec(text)) !== null) {
        if (match.index > lastIndex) {
          parts.push(document.createTextNode(text.substring(lastIndex, match.index)));
        }

        const language = match[1] || 'text';
        const code = match[2].trim();
        parts.push(createCodeBlock(code, language));

        lastIndex = match.index + match[0].length;
      }

      if (lastIndex < text.length) {
        parts.push(document.createTextNode(text.substring(lastIndex)));
      }

      return parts;
    }

    function appendMessage(text, cls = 'ai') {
      const msgEl = document.createElement('div');
      msgEl.className = 'msg ' + cls;

      const formattedContent = formatMessage(text);
      formattedContent.forEach(part => msgEl.appendChild(part));

      messages.appendChild(msgEl);
      messages.scrollTop = messages.scrollHeight;

      return msgEl;
    }

    async function sendPrompt(userText) {
      if (!userText.trim()) return;
      appendMessage(userText, 'user');

      const fileList = docs.map(d => d.name).join(', ');

      const selectorPrompt = `
You are a document selector for Bloxd.io coding docs.
The user asked: "${userText}"
Here is the list of files available: ${fileList}
Which files are likely needed to answer this question? Respond with the file names only, separated by commas.
`;

      const loadingMsg = appendMessage('Analyzing which documentation files are most relevant...', 'ai');
      if (loadingMsg) {
        loadingMsg.classList.add('thinking');
      }

      try {
        const selectionResponse = await puter.ai.chat(selectorPrompt);
        let selectedFilesText = '';

        if (typeof selectionResponse === 'string') {
          selectedFilesText = selectionResponse;
        } else if (selectionResponse && typeof selectionResponse === 'object') {
          if (selectionResponse.message && selectionResponse.message.content) {
            selectedFilesText = selectionResponse.message.content;
          } else if (selectionResponse.text) {
            selectedFilesText = selectionResponse.text;
          } else if (selectionResponse.content) {
            selectedFilesText = selectionResponse.content;
          } else {
            selectedFilesText = JSON.stringify(selectionResponse);
          }
        } else {
          selectedFilesText = String(selectionResponse);
        }

        const selectedFileNames = selectedFilesText
          .split(',')
          .map(name => name.trim())
          .filter(name => name.length > 0);

        const selectedDocs = docs.filter(d =>
          d.name === 'EXTRA.md' ||
          d.name === 'SIMPLES.md' ||
          selectedFileNames.some(selectedName =>
            d.name.toLowerCase() === selectedName.toLowerCase()
          )
        );

        const filesConcat = selectedDocs.map(d => `--- ${d.name} ---\n${d.text}`).join('\n\n');
        const extras = extraInfo || '';
        const promptParts = [];
        if (filesConcat) promptParts.push('CONTEXT:\n' + filesConcat);
        if (extras) promptParts.push('SYSTEM CONTEXT:\n' + extras);
        promptParts.push('USER QUESTION:\n' + userText);
        const prompt = promptParts.join('\n\n');

        if (loadingMsg) {
          loadingMsg.textContent = 'One sec, Melting... Forging... Cooling...';
        }

        const response = await puter.ai.chat(prompt);

        if (loadingMsg) {
          loadingMsg.remove();
        }

        let text = '';
        if (typeof response === 'string') {
          text = response;
        } else if (response && typeof response === 'object') {
          if (response.message && response.message.content) {
            text = response.message.content;
          } else if (response.text) {
            text = response.text;
          } else if (response.content) {
            text = response.content;
          } else {
            text = JSON.stringify(response);
          }
        } else {
          text = String(response);
        }

        appendMessage(text, 'ai');
      } catch (err) {
        const last = messages.querySelectorAll('.msg.ai.thinking'); if (last.length) last[last.length - 1].remove();
        appendMessage('Error: ' + err.message, 'ai');
        console.error(err);
      }
    }

    send.addEventListener('click', () => { sendPrompt(input.value); input.value = ''; input.focus(); });
    input.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send.click(); } });

    runExampleBtn.onclick = () => {
      input.value = 'How can I create an aura effect around the player with particles?'; send.click();
    }

    clearChatBtn.onclick = () => { messages.innerHTML = ''; }

    reloadContextBtn.onclick = () => {
      messages.innerHTML = '';
      loadMarkdownFiles();
      appendMessage('Context files reloaded successfully!', 'ai');
    }

    const demoMsg = appendMessage('I have automatically loaded documentation files as context. Ask me anything about the available documentation!', 'ai');
    if (demoMsg) {
      demoMsg.classList.add('thinking');
      setTimeout(() => {
        demoMsg.classList.remove('thinking');
      }, 3000);
    }
  </script>
</body>

</html>