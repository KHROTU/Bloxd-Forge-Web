<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>BloxdForge 3.0</title>
  <link rel="icon" href="/favicon.ico" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://js.puter.com/v2/"></script>
  <style>
    * {
      box-sizing: border-box;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    html,
    body {
      margin: 0;
      height: 100%;
      background: #141313;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #e0e0e0;
      overflow: hidden;
    }

    .container {
      display: flex;
      height: 100vh;
      padding: 20px;
      gap: 20px;
      justify-content: space-between;
      align-items: stretch;
      background: radial-gradient(circle at top right, #1e1c1c, #141313);
      transition: all 0.3s ease;
    }

    .container.pro-layout {
      gap: 20px;
      justify-content: flex-start;
    }

    .container.pro-layout iframe {
      margin-right: 0 !important;
      flex: 1;
      width: calc(100% - 30vh - 20px);
    }

    .sidebar {
      background: linear-gradient(180deg, #1b1a1a 0%, #191818 100%);
      border: 1px solid #2c2b2b;
      border-radius: 35px;
      padding: 24px 20px;
      width: 30vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
      flex-shrink: 0;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .right-sidebar {
      padding: 0;
      overflow: hidden;
      width: 20vh !important;
    }

    .right-sidebar iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 25px;
    }

    .sidebar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, #ff6b3944, transparent);
    }

    .logo {
      text-align: center;
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 1px solid #2c2b2b;
    }

    .logo h1 {
      font-size: 1.8rem;
      margin: 0;
      background: linear-gradient(45deg, #ff6b39, #ff8c5a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    .logo span {
      color: #a0a0a0;
      font-size: 0.8rem;
      letter-spacing: 1px;
    }

    .cards {
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow-y: auto;
      padding: 5px;
    }

    .cards::-webkit-scrollbar {
      width: 4px;
    }

    .cards::-webkit-scrollbar-thumb {
      background: #ff6b39;
      border-radius: 10px;
    }

    .card {
      background: linear-gradient(90deg, #262525 0%, #242323 100%);
      border: 1px solid #3a3939;
      padding: 16px 20px;
      border-radius: 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 80px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .card:hover::before {
      left: 100%;
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 7px 15px rgba(0, 0, 0, 0.2);
      border-color: #4a4949;
    }

    .card-title {
      font-size: 1.1rem;
      color: #e8e8e8;
      font-weight: 500;
      z-index: 1;
    }

    .card-icon {
      width: 50px;
      height: 50px;
      background: rgba(255, 107, 57, 0.1);
      border-radius: 14px;
      margin-left: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.6rem;
      color: #ff6b39;
      z-index: 1;
    }

    .bottom-section {
      border-top: 1px solid #2c2b2b;
      padding-top: 20px;
    }

    .bottom-buttons {
      display: flex;
      gap: 12px;
      margin-top: 10px;
    }

    .cube-btn {
      width: 70px;
      height: 70px;
      background: linear-gradient(145deg, #262525, #212020);
      border: 1px solid #444343;
      border-radius: 18px;
      font-size: 1.6rem;
      font-weight: bold;
      line-height: 0;
      color: #ff6b39;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    .cube-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
      color: #ff8c5a;
    }

    .long-btn {
      flex: 1;
      background: linear-gradient(145deg, #262525, #212020);
      border: 1px solid #444343;
      border-radius: 18px;
      padding: 0 12px;
      font-size: 1.6rem;
      font-weight: bold;
      line-height: 0;
      color: #e8e8e8;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    .long-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    }

    iframe {
      flex: 1;
      height: 100%;
      border-radius: 35px;
      border: 1.5px solid #2c2b2b;
      background: #000;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      transition: filter 0.3s ease, opacity 0.3s ease;
    }

    iframe.blurred {
      filter: blur(20px);
      opacity: 0.5;
    }

    .active-card {
      background: linear-gradient(90deg, #ff6b39 0%, #ff8c5a 100%) !important;
      border: 1px solid #f78c5a !important;
      color: #fff !important;
      font-weight: bold !important;
    }

    .active-card .card-title {
      color: #fff !important;
    }

    .active-card .card-icon {
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
    }

    .active-btn {
      background: linear-gradient(145deg, #ff6b39, #e55a2e) !important;
      border: 1px solid #f78c5a !important;
      color: #fff !important;
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      color: #a0a0a0;
      font-size: 0.85rem;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(45deg, #ff6b39, #ff8c5a);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.9rem;
    }

    .loading-indicator {
      width: 16px;
      height: 16px;
      border: 2px solid #444343;
      border-top: 2px solid #ff6b39;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: none;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .notification {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #ff6b39;
      color: white;
      padding: 10px 16px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(255, 107, 57, 0.3);
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.4s ease;
      z-index: 1000;
    }

    .notification.show {
      opacity: 1;
      transform: translateY(0);
    }

    .tooltip {
      position: relative;
    }

    .tooltip::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #ff6b39;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.8rem;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      margin-bottom: 8px;
    }

    .tooltip:hover::after {
      opacity: 1;
      visibility: visible;
    }

    .sidebar {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .top-section {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .cards {
      flex-grow: 1;
      overflow-y: auto;
    }

    .popupinfo {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(145deg, #ff6b39, #e55a2e);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      z-index: 1000;
    }

    .popupinfo button {
      background: #ff8258;
      box-shadow: 0 5px 0px #ec7a45;
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      margin: 10px 5px;
      transition: all 0.3s ease;
    }

    .popupinfo button:hover {
      transform: translateY(5px);
      box-shadow: 0 5px 15px rgba(255, 107, 57, 0.4);
    }

    .showpop {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(145deg, #ff6b39, #e55a2e);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      max-width: 300px;
      transform: translateX(120%);
      transition: transform 0.3s ease;
    }

    .showpop.show {
      transform: translateX(0);
    }

    .showpop h3 {
      margin: 0 0 10px 0;
      font-size: 1.2rem;
      color: white;
    }

    .showpop p {
      margin: 0 0 15px 0;
      font-size: 0.9rem;
      color: #fff9f9;
    }

    .showpop-buttons {
      display: flex;
      gap: 10px;
    }

    .showpop-btn {
      background: #ff8258;
      box-shadow: 0 3px 0px #ec7a45;
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      flex: 1;
      text-align: center;
    }

    .showpop-btn:hover {
      transform: translateY(2px);
      box-shadow: 0 1px 5px rgba(255, 107, 57, 0.4);
    }

    .showpop-btn.try {
      box-shadow: 0 3px 0px #ff8f5c;
    }

    .showpop-btn.try:hover {
      transform: translateY(2px);
      box-shadow: 0 1px 5px rgba(255, 200, 80, 0.4);
    }

    .showpop-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .showpop-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    a {
      color: white;
    }

    .auth-section {
      padding-top: 16px;
    }

    .auth-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .auth-popup-content {
      background: linear-gradient(145deg, #262525, #212020);
      border: 1px solid #444343;
      border-radius: 15px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
    }

    .auth-popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }

    .auth-popup-header h3 {
      margin: 0;
      color: #e0e0e0;
      font-size: 1.3rem;
    }

    .auth-popup-close {
      background: none;
      border: none;
      color: #a0a0a0;
      font-size: 1.5rem;
      cursor: pointer;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .auth-popup-close:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
    }

    .auth-popup-body {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .upgrade-section {
    }

    .upgrade-section h4 {
      margin: 0 0 12px 0;
      color: #e0e0e0;
      font-size: 1.1rem;
      font-weight: 600;
    }

    #open-upgrade-btn {
      width: 100%;
      margin-bottom: 15px;
    }

    #code-input {
      margin-bottom: 0;
    }

    #code-message.success {
      color: #4ade80;
    }

    #code-message.error {
      color: #f87171;
    }

    .auth-user-info {
      background: linear-gradient(145deg, #262525, #212020);
      border: 1px solid #444343;
      border-radius: 15px;
      padding: 12px;
      display: flex;
      gap: 10px;
      align-items: center;
      color: #e0e0e0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      margin-bottom: 12px;
      height: 70px;
    }

    .auth-menu-btn {
      width: 44px;
      height: 44px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid #444343;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 22px;
      color: #a0a0a0;
      margin-left: auto;
    }

    .auth-menu-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .auth-menu-btn.active {
      background: rgba(255, 255, 255, 0.3);
      color: #fff;
      border-color: #555454;
    }

    .auth-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      color: #fff;
      flex-shrink: 0;
      transition: all 0.18s ease;
      background: linear-gradient(135deg, #262525, #1b1a1a);
      border: 1px solid #444343;
    }

    .auth-avatar.vip {
      box-shadow: 0 0 0 2px rgba(255, 200, 80, 0.2), 0 4px 12px rgba(255, 200, 80, 0.3);
      animation: vipGlow 2s infinite alternate;
    }

    @keyframes vipGlow {
      0% {
        box-shadow: 0 0 0 2px rgba(255, 200, 80, 0.2), 0 4px 12px rgba(255, 200, 80, 0.3);
      }

      100% {
        box-shadow: 0 0 0 2px rgba(255, 200, 80, 0.4), 0 4px 12px rgba(255, 200, 80, 0.5);
      }
    }

    .auth-username {
      font-weight: 500;
      font-size: 13px;
      flex: 1;
      margin-left: 8px;
    }

    .auth-user-rank {
      font-size: 11px;
      font-weight: 400;
      color: #666;
      margin-left: 6px;
      padding: 2px 6px;
      border-radius: 4px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid #444;
    }

    .auth-user-rank.pro {
      color: #ffc850;
      border-color: #ffc850;
      background: rgba(255, 200, 80, 0.1);
    }

    .auth-user-rank.free {
      color: #888;
      border-color: #555;
      background: rgba(136, 136, 136, 0.1);
    }

    .auth-user-rank.yt-pro {
      color: #ff0000;
      border-color: #ff0000;
      background: rgba(255, 0, 0, 0.1);
      font-weight: bold;
    }

    .auth-btn {
      background: linear-gradient(145deg, #262525, #1b1a1a);
      color: #e0e0e0;
      border: 1px solid #444343;
      padding: 10px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .auth-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      background: linear-gradient(145deg, #2c2b2b, #212020);
    }

    .auth-btn.secondary {
      background: linear-gradient(145deg, #262525, #1b1a1a);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      border: 1px solid #444343;
    }

    .auth-btn.secondary:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      background: linear-gradient(145deg, #2c2b2b, #212020);
    }

    .profile-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 8px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .form-group label {
      font-size: 12px;
      color: #a0a0a0;
      font-weight: 500;
    }

    .form-input,
    .form-select {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #444343;
      background: #1b1a1a;
      color: #e0e0e0;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .form-input:focus,
    .form-select:focus {
      outline: none;
      border-color: #555454;
      box-shadow: 0 0 0 2px rgba(85, 84, 84, 0.1);
    }

    .form-input:disabled,
    .form-select:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .auth-status {
      font-size: 12px;
      color: #a0a0a0;
      text-align: center;
      margin-bottom: 8px;
      background: rgba(0, 0, 0, 0.2);
      padding: 6px;
      border-radius: 8px;
      border: 1px solid #444343;
    }

    .profile-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .profile-data {
      max-height: 100px;
      overflow-y: auto;
      background: #1b1a1a;
      border: 1px solid #444343;
      border-radius: 8px;
      padding: 8px;
      font-size: 12px;
      color: #a0a0a0;
      white-space: pre-wrap;
      margin-top: 8px;
      display: none;
    }

    .profile-data::-webkit-scrollbar {
      width: 4px;
    }

    .profile-data::-webkit-scrollbar-thumb {
      background: #ff6b39;
      border-radius: 2px;
    }

    .settings-tabs {
      display: flex;
      border-bottom: 1px solid #444343;
      margin-bottom: 20px;
    }

    .tab-btn {
      background: transparent;
      border: none;
      padding: 10px 15px;
      color: #a0a0a0;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .tab-btn:hover {
      color: #e0e0e0;
    }

    .tab-btn.active {
      color: #ff6b39;
      border-bottom: 2px solid #ff6b39;
    }

    .tab-content {
      min-height: 200px;
    }

    .tab-pane {
      display: none;
    }

    .tab-pane.active {
      display: block;
    }

    .credits-info {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid #444343;
      border-radius: 10px;
      padding: 15px;
      margin-top: 10px;
    }

    .credit-item {
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .credit-item:last-child {
      border-bottom: none;
    }

    .credit-name {
      font-weight: 600;
      color: #ff6b39;
      font-size: 14px;
      margin-bottom: 3px;
    }

    .credit-role {
      font-size: 12px;
      color: #a0a0a0;
      margin-bottom: 3px;
      font-style: italic;
    }

    .credit-desc {
      font-size: 12px;
      color: #c0c0c0;
      line-height: 1.3;
    }

    .credit-link {
      margin-top: 10px;
      text-align: center;
    }

    .credits-section h4 {
      color: #e0e0e0;
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 12px;
    }
  </style>
  <link rel="stylesheet" href="./assets/data/scroll.css">
</head>
<div class="popupinfo" id="popupinfo">
  <p>The advertisements are not affiliated with BloxdForge. Any actions you take in response to them are your own
    responsibility.<a href="https://www.bloxdforge.com/privacy" target="_blank">Privacy Policy</a>
  </p>
  <button id="closePopup">Never show up again</button>
</div>

<div class="showpop" id="showpop">
  <button class="showpop-close" id="showpopClose">&times;</button>
  <h3>Try BloxdForge Pro!</h3>
  <p>No more ads and support the developers of BloxdForge, Its free!</p>
  <div class="showpop-buttons">
    <button class="showpop-btn" id="showpopDismiss">Dismiss</button>
    <button class="showpop-btn try" id="showpopTry">Try Pro</button>
  </div>
</div>

<body>
  <div class="notification" id="notification">Welcome to BloxdForge 3.0!</div>

  <div class="container">
    <div class="sidebar">
      <div class="logo">
        <h1>BLOXDFORGE</h1>
        <span>THE BEST.</span>
      </div>

      <div class="cards">
        <div class="card tooltip" data-url="./assets/creator.html" data-tooltip="Create new projects">
          <span class="card-title">Creator</span>
          <div class="card-icon"><i class="fas fa-tools"></i></div>
        </div>
        <div class="card tooltip" data-url="./assets/workshop.html" data-tooltip="Browse community creations">
          <span class="card-title">Workshop</span>
          <div class="card-icon"><i class="fas fa-toolbox"></i></div>
        </div>
        <div class="card tooltip" data-url="./assets/wiki.html" data-tooltip="Learn how to use BloxdForge">
          <span class="card-title">Wiki</span>
          <div class="card-icon"><i class="fas fa-book"></i></div>
        </div>
      </div>

      <div class="bottom-section">
        <div class="bottom-buttons">
          <button class="cube-btn tooltip" id="fullscreenBtn"><i class="fas fa-expand"></i></button>
          <button class="long-btn active-btn" data-url="./assets/home.html"><i class="fas fa-home"></i></button>
        </div>

        <div class="auth-section">
          <div class="auth-user-info" id="auth-user-info">
            <div class="auth-avatar" id="auth-avatar">?</div>
            <div class="auth-username" id="auth-username">Not signed in</div>
            <div class="auth-user-rank" id="auth-user-rank" style="display: none;">Free</div>
            <div class="auth-menu-btn" id="auth-menu-btn" title="Open profile menu">
              <i class="fas fa-cog"></i>
            </div>
          </div>
        </div>

        <div class="auth-popup" id="auth-popup" style="display: none;">
          <div class="auth-popup-content">
            <div class="auth-popup-header">
              <h3>Settings</h3>
              <button class="auth-popup-close" id="auth-popup-close">&times;</button>
            </div>

            <div class="auth-popup-body">
              <!-- Tab Navigation -->
              <div class="settings-tabs">
                <button class="tab-btn active" data-tab="account">Account</button>
                <button class="tab-btn" data-tab="upgrade">Upgrade</button>
                <button class="tab-btn" data-tab="credits">Credits</button>
              </div>
              <!-- Tab Content -->
              <div class="tab-content">
                <!-- Account Tab -->
                <div class="tab-pane active" id="account-tab">
                  <div class="auth-status" id="auth-status">signed out</div>

                  <button class="auth-btn" id="sign-in-btn">Sign In</button>
                  <button class="auth-btn secondary" id="sign-out-btn" style="display: none;">Sign Out</button>

                  <div class="profile-form" id="profile-form" style="display: none;">
                    <div class="form-group">
                      <label>Description</label>
                      <input class="form-input" id="profile-description" type="text" placeholder="Enter description"
                        disabled />
                    </div>

                    <div class="form-group">
                      <label>Account Type</label>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <select class="form-select" id="profile-section" disabled>
                          <option value="Free">Free</option>
                          <option value="Pro">Pro</option>
                        </select>
                      </div>
                    </div>

                    <div class="profile-actions">
                      <button class="auth-btn" id="save-profile-btn" disabled>Save</button>
                      <button class="auth-btn secondary" id="load-profile-btn" disabled>Load</button>
                    </div>

                    <div class="profile-data" id="profile-data"></div>
                  </div>
                </div>
                <!-- Upgrade Tab -->
                <div class="tab-pane" id="upgrade-tab">
                  <div class="upgrade-section">
                    <h4>Upgrade Options</h4>
                    <button class="auth-btn" id="open-upgrade-btn">Upgrade with Ads</button>

                    <h4>Redeem Code</h4>
                    <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                      <input type="text" class="form-input" id="code-input" placeholder="Enter code" />
                      <button class="auth-btn" id="redeem-code-btn"
                        style="padding: 8px 12px; font-size: 12px;">Redeem</button>
                    </div>
                    <div id="code-message" style="font-size: 12px; min-height: 18px;"></div>
                  </div>
                </div>
                <!-- Credits Tab -->
                <div class="tab-pane" id="credits-tab">
                  <div class="upgrade-section credits-section">
                    <h4>Project Credits</h4>
                    <div class="credits-info">
                      <div class="credit-item">
                        <div class="credit-name">A_I_X</div>
                        <div class="credit-role">Founder & Creator</div>
                        <div class="credit-desc">Founder of ProduX & Creator of BloxdForge</div>
                      </div>
                      <div class="credit-item">
                        <div class="credit-name">KHROTU</div>
                        <div class="credit-role">Lead Developer</div>
                        <div class="credit-desc">Head developer, worked on everything</div>
                      </div>
                      <div class="credit-item">
                        <div class="credit-name">GEORGECR</div>
                        <div class="credit-role">Developer</div>
                        <div class="credit-desc">Helped with the World Forge</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <iframe src="./assets/home.html" id="contentFrame"></iframe>

    <div class="sidebar right-sidebar">
      <iframe src="https://www.bloxdforge.com/assets/iframes/ad.html"
        style="width: 100%; height: 100%; border: none; border-radius: 25px;"></iframe>
    </div>
  </div>

  <script>
    let CURRENT_USER = null;

    const authUserInfo = document.getElementById('auth-user-info');
    const authAvatar = document.getElementById('auth-avatar');
    const authUsername = document.getElementById('auth-username');
    const authUserRank = document.getElementById('auth-user-rank');
    const authMenuBtn = document.getElementById('auth-menu-btn');
    const authStatus = document.getElementById('auth-status');
    const signInBtn = document.getElementById('sign-in-btn');
    const signOutBtn = document.getElementById('sign-out-btn');
    const profileForm = document.getElementById('profile-form');
    const profileDescription = document.getElementById('profile-description');
    const profileSection = document.getElementById('profile-section');
    const saveProfileBtn = document.getElementById('save-profile-btn');
    const loadProfileBtn = document.getElementById('load-profile-btn');
    const profileData = document.getElementById('profile-data');
    const upgradeProBtn = document.getElementById('upgrade-pro-btn');

    function filenameForUser() {
      return 'bloxdforge-userdata.json';
    }

    function saveToLocalStorage(key, data) {
      try {
        localStorage.setItem(key, JSON.stringify(data));
      } catch (e) {
        console.error('Error saving to localStorage:', e);
      }
    }

    function loadFromLocalStorage(key) {
      try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : null;
      } catch (e) {
        console.error('Error loading from localStorage:', e);
        return null;
      }
    }

    function clearLocalStorage(key) {
      try {
        localStorage.removeItem(key);
      } catch (e) {
        console.error('Error clearing localStorage:', e);
      }
    }

    function getOrCreateGradient(username) {
      if (!username) return 'linear-gradient(135deg, #ff6b39, #ff8c5a)';
      const key = 'bloxdforge-gradient:' + username;
      let v = localStorage.getItem(key);
      if (v) return v;
      const colors = ['#ff6b39', '#ff8c5a', '#e55a2e', '#ff7849', '#f7834a'];
      const g = `linear-gradient(135deg, ${colors[Math.floor(Math.random() * colors.length)]}, ${colors[Math.floor(Math.random() * colors.length)]})`;
      localStorage.setItem(key, g);
      return g;
    }

    function applyVipStyle(section) {
      if (section === 'Pro' || section === 'YT Pro') {
        authAvatar.classList.add('vip');
      } else {
        authAvatar.classList.remove('vip');
      }
    }

    function updateUserRank(section) {
      if (section && (section === 'Pro' || section === 'Free' || section === 'YT Pro')) {
        if (section === 'YT Pro' && CURRENT_USER?.proExpiration) {

          const expirationTime = new Date(CURRENT_USER.proExpiration);
          const timeLeft = Math.max(0, Math.floor((expirationTime.getTime() - Date.now()) / (1000 * 60)));
          if (timeLeft > 60 * 24) {
            authUserRank.textContent = `YT Pro (${Math.floor(timeLeft / (60 * 24))}d)`;
          } else if (timeLeft > 60) {
            authUserRank.textContent = `YT Pro (${Math.floor(timeLeft / 60)}h)`;
          } else {
            authUserRank.textContent = `YT Pro (${timeLeft}m)`;
          }
          authUserRank.style.color = '#ff0000'; 
          authUserRank.className = 'auth-user-rank yt-pro';
        } else if (section === 'Pro' && CURRENT_USER?.proExpiration) {
          if (CURRENT_USER.proExpiration === 'forever') {
            authUserRank.textContent = 'Pro';
            authUserRank.style.color = '#ffc850';
          } else {
            const expirationTime = new Date(CURRENT_USER.proExpiration);
            const timeLeft = Math.max(0, Math.floor((expirationTime.getTime() - Date.now()) / (1000 * 60)));
            if (timeLeft > 60 * 24) {
              authUserRank.textContent = `Pro (${Math.floor(timeLeft / (60 * 24))}d)`;
            } else if (timeLeft > 60) {
              authUserRank.textContent = `Pro (${Math.floor(timeLeft / 60)}h)`;
            } else {
              authUserRank.textContent = `Pro (${timeLeft}m)`;
            }
            authUserRank.style.color = '#666';
          }
          authUserRank.className = 'auth-user-rank pro';
        } else {
          authUserRank.textContent = section;
          authUserRank.style.color = '#666';
          authUserRank.className = `auth-user-rank ${section.toLowerCase()}`;
        }

        authUserRank.style.display = 'block';

        if (upgradeProBtn) {
          upgradeProBtn.style.display = (section === 'Free' || section === 'YT Pro') ? 'block' : 'none';
        }

        if (CURRENT_USER) {
          CURRENT_USER.userType = section;
          saveToLocalStorage('bloxdforge-user', CURRENT_USER);
        }

        manageAdsForUserType(section === 'Free' ? 'Free' : 'Pro'); 
      } else {
        authUserRank.style.display = 'none';
        if (upgradeProBtn) {
          upgradeProBtn.style.display = 'block';
        }
        manageAdsForUserType('Free');
      }
    }

    function getCurrentUserType() {
      console.log('=== Getting current user type ===');
      console.log('CURRENT_USER:', CURRENT_USER);

      if (!CURRENT_USER?.username) {
        console.log('No current user, returning Free');
        return 'Free';
      }

      if (CURRENT_USER.userType === 'YT Pro' && CURRENT_USER.proExpiration) {
        const expirationTime = new Date(CURRENT_USER.proExpiration);
        if (Date.now() > expirationTime.getTime()) {
          console.log('YT Pro status expired, downgrading to Free');
          CURRENT_USER.userType = 'Free';
          delete CURRENT_USER.proExpiration;
          saveToLocalStorage('bloxdforge-user', CURRENT_USER);
          updateUserRank('Free');
          return 'Free';
        }
        console.log('YT Pro status, returning YT Pro');
        return 'YT Pro'; 
      }

      if (CURRENT_USER.userType === 'Pro' && CURRENT_USER.proExpiration) {
        if (CURRENT_USER.proExpiration === 'forever') {
          console.log('Forever Pro status, returning Pro');
          return 'Pro';
        }

        const expirationTime = new Date(CURRENT_USER.proExpiration);
        if (Date.now() > expirationTime.getTime()) {
          console.log('Pro status expired, downgrading to Free');
          CURRENT_USER.userType = 'Free';
          delete CURRENT_USER.proExpiration;
          saveToLocalStorage('bloxdforge-user', CURRENT_USER);
          updateUserRank('Free');
          return 'Free';
        }
      }

      if (CURRENT_USER && CURRENT_USER.userType) {
        console.log('User type from CURRENT_USER:', CURRENT_USER.userType);
        return CURRENT_USER.userType; 
      }

      if (profileSection && profileSection.value && profileSection.value !== '') {
        console.log('User type from profileSection:', profileSection.value);
        if (CURRENT_USER) {
          CURRENT_USER.userType = profileSection.value;
          saveToLocalStorage('bloxdforge-user', CURRENT_USER);
        }
        return profileSection.value;
      }

      const storedUser = loadFromLocalStorage('bloxdforge-user');
      console.log('Stored user data:', storedUser);
      if (storedUser && storedUser.userType) {
        console.log('User type from stored data:', storedUser.userType);
        if (CURRENT_USER) {
          CURRENT_USER.userType = storedUser.userType;
        }
        if (profileSection) {
          profileSection.value = storedUser.userType;
        }
        return storedUser.userType;
      }

      console.log('Defaulting to Free user type');
      return 'Free';
    }

    function manageAdsForUserType(userType) {
      const rightSidebar = document.querySelector('.right-sidebar');
      const iframe = document.getElementById('contentFrame');
      const container = document.querySelector('.container');

      console.log('Managing ads for user type:', userType);

      if (userType === 'Pro' || userType === 'YT Pro') { 
        if (rightSidebar) {
          rightSidebar.style.display = 'none';
        }
        if (container) {
          container.classList.add('pro-layout');
        }
        if (iframe) {
          iframe.style.marginRight = '';
          iframe.style.width = '';
        }

        if (iframe && iframe.contentWindow) {
          try {
            iframe.contentWindow.postMessage({ action: 'hideAds', userType: userType }, '*');
          } catch (e) {
            console.log('Could not communicate with iframe:', e);
          }
        }

        setTimeout(() => {
          if (container) {
            container.style.display = 'none';
            container.offsetHeight;
            container.style.display = 'flex';
          }
        }, 10);
      } else {
        if (rightSidebar) {
          rightSidebar.style.display = 'block';
        }
        if (container) {
          container.classList.remove('pro-layout');
        }
        if (iframe) {
          iframe.style.marginRight = '';
          iframe.style.width = '';
        }

        if (iframe && iframe.contentWindow) {
          try {
            iframe.contentWindow.postMessage({ action: 'showAds', userType: 'Free' }, '*');
          } catch (e) {
            console.log('Could not communicate with iframe:', e);
          }
        }
      }
    }

    async function setSignedIn(user) {
      CURRENT_USER = user || null;

      if (user && user.username) {
        saveToLocalStorage('bloxdforge-user', user);

        authUserInfo.style.display = 'flex';
        authUsername.textContent = user.username;
        authAvatar.textContent = user.username.charAt(0).toUpperCase();
        authAvatar.style.background = getOrCreateGradient(user.username);

        signInBtn.style.display = 'none';
        signOutBtn.style.display = 'block';

        authStatus.textContent = 'signed in';

        try {
          await loadProfileFile();
        } catch (e) {
          profileForm.style.display = 'block';
          profileDescription.disabled = false;
          profileSection.disabled = false;
          saveProfileBtn.disabled = false;
          loadProfileBtn.disabled = false;

          profileData.style.display = 'block';
          profileData.textContent = 'No saved profile found.';
        }

        document.getElementById('auth-popup').style.display = 'none';
        authMenuBtn.classList.remove('active');

        showNotification(`Welcome back, ${user.username}!`);
      } else {
        clearLocalStorage('bloxdforge-user');

        authUserInfo.style.display = 'flex';
        document.getElementById('auth-popup').style.display = 'none';
        authMenuBtn.classList.remove('active');
        authUsername.textContent = 'Not signed in';
        authUserRank.style.display = 'none';
        authAvatar.textContent = '?';
        authAvatar.style.background = 'linear-gradient(135deg, #ff6b39, #ff8c5a)';
        authAvatar.classList.remove('vip');

        signInBtn.style.display = 'block';
        signOutBtn.style.display = 'none';
        profileForm.style.display = 'none';

        authStatus.textContent = 'signed out';

        profileDescription.disabled = true;
        profileDescription.value = '';
        profileSection.disabled = true;
        profileSection.value = 'Free';
        saveProfileBtn.disabled = true;
        loadProfileBtn.disabled = true;

        profileData.style.display = 'none';
        profileData.textContent = '';
      }
    }

    async function saveProfileFile() {
      if (!CURRENT_USER?.username) {
        showNotification('Please sign in first');
        return;
      }

      const payload = {
        description: profileDescription.value.trim(),
        section: profileSection.value,
        savedAt: new Date().toISOString(),
        app: 'BloxdForge'
      };

      if (!payload.description) {
        showNotification('Please enter a description');
        return;
      }

      try {
        await puter.fs.write(filenameForUser(), JSON.stringify(payload, null, 2));
        showNotification('Profile saved successfully!');

        profileForm.style.display = 'none';
        applyVipStyle(payload.section);
        updateUserRank(payload.section);

        if (CURRENT_USER) {
          CURRENT_USER.userType = payload.section;
          saveToLocalStorage('bloxdforge-user', CURRENT_USER);
        }

        const expirationText = payload.section === 'Pro' && payload.proExpiration ? ' (Expires in 1 hour)' : '';
        profileData.style.display = 'block';
        profileData.innerHTML = `Description: ${payload.description}\nAccount Type: ${payload.section}${expirationText}\n\n<button class="auth-btn" onclick="showEditForm()">Edit Profile</button>`;
      } catch (e) {
        showNotification('Error saving profile');
        console.error(e);
      }
    }

    function showEditForm() {
      if (!CURRENT_USER?.username) {
        showNotification('Please sign in first');
        return;
      }

      profileForm.style.display = 'block';
      profileDescription.disabled = false;
      profileSection.disabled = false;
      saveProfileBtn.disabled = false;
      loadProfileBtn.disabled = false;

      profileData.style.display = 'none';
    }

    window.showEditForm = showEditForm;

    async function upgradeUserToPro() {
      if (!CURRENT_USER?.username) {
        showNotification('Please sign in first');
        return;
      }

      try {
        const expirationTime = new Date(Date.now() + 60 * 60 * 1000);
        const payload = {
          description: profileDescription.value.trim() || 'Pro User',
          section: 'Pro',
          savedAt: new Date().toISOString(),
          app: 'BloxdForge',
          upgradedAt: new Date().toISOString(),
          proExpiration: expirationTime.toISOString()
        };

        await puter.fs.write(filenameForUser(), JSON.stringify(payload, null, 2));

        profileSection.value = 'Pro';
        applyVipStyle('Pro');
        updateUserRank('Pro');

        if (CURRENT_USER) {
          CURRENT_USER.userType = 'Pro';
          CURRENT_USER.proExpiration = expirationTime.toISOString();
          saveToLocalStorage('bloxdforge-user', CURRENT_USER);
        }

        manageAdsForUserType('Pro');

        profileForm.style.display = 'none';
        profileData.style.display = 'block';
        profileData.innerHTML = `Description: ${payload.description}\nAccount Type: Pro (Expires in 1 hour)\n\n<button class="auth-btn" onclick="showEditForm()">Edit Profile</button>`;

        if (authUserRank) {
          authUserRank.textContent = 'Pro (60m)';
        }

        showNotification('🎉 Congratulations! You are now a Pro user for 1 hour!');

      } catch (e) {
        showNotification('Error upgrading to Pro');
        console.error(e);
      }
    }

    async function upgradeUserToProWeek() {
      if (!CURRENT_USER?.username) {
        showNotification('Please sign in first');
        return;
      }

      try {
        const expirationTime = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);
        const payload = {
          description: profileDescription.value.trim() || 'Pro User',
          section: 'Pro',
          savedAt: new Date().toISOString(),
          app: 'BloxdForge',
          upgradedAt: new Date().toISOString(),
          proExpiration: expirationTime.toISOString()
        };

        await puter.fs.write(filenameForUser(), JSON.stringify(payload, null, 2));

        profileSection.value = 'Pro';
        applyVipStyle('Pro');
        updateUserRank('Pro');

        if (CURRENT_USER) {
          CURRENT_USER.userType = 'Pro';
          CURRENT_USER.proExpiration = expirationTime.toISOString();
          saveToLocalStorage('bloxdforge-user', CURRENT_USER);
        }

        manageAdsForUserType('Pro');

        profileForm.style.display = 'none';
        profileData.style.display = 'block';
        profileData.innerHTML = `Description: ${payload.description}\nAccount Type: Pro (Expires in 1 week)\n\n<button class="auth-btn" onclick="showEditForm()">Edit Profile</button>`;

        if (authUserRank) {
          const timeLeft = Math.max(0, Math.floor((expirationTime.getTime() - Date.now()) / (1000 * 60)));
          authUserRank.textContent = `Pro (${Math.floor(timeLeft / 60)}h)`;
        }

        showNotification('🎉 Congratulations! You are now a Pro user for 1 week!');

      } catch (e) {
        showNotification('Error upgrading to Pro for 1 week');
        console.error(e);
      }
    }

    async function upgradeUserToProForever() {
      if (!CURRENT_USER?.username) {
        showNotification('Please sign in first');
        return;
      }

      try {
        const payload = {
          description: profileDescription.value.trim() || 'Pro User',
          section: 'Pro',
          savedAt: new Date().toISOString(),
          app: 'BloxdForge',
          upgradedAt: new Date().toISOString(),
          proExpiration: 'forever'
        };

        await puter.fs.write(filenameForUser(), JSON.stringify(payload, null, 2));

        profileSection.value = 'Pro';
        applyVipStyle('Pro');
        updateUserRank('Pro');

        if (CURRENT_USER) {
          CURRENT_USER.userType = 'Pro';
          CURRENT_USER.proExpiration = 'forever';
          saveToLocalStorage('bloxdforge-user', CURRENT_USER);
        }

        manageAdsForUserType('Pro');

        profileForm.style.display = 'none';
        profileData.style.display = 'block';
        profileData.innerHTML = `Description: ${payload.description}\nAccount Type: Pro (Forever)\n\n<button class="auth-btn" onclick="showEditForm()">Edit Profile</button>`;

        if (authUserRank) {
          authUserRank.textContent = 'Pro';
          authUserRank.style.color = '#ffc850';
        }

        showNotification('🎉 Congratulations! You are now a Pro user forever!');

      } catch (e) {
        showNotification('Error upgrading to Pro Forever');
        console.error(e);
      }
    }

    async function upgradeUserToYTPro() {
      if (!CURRENT_USER?.username) {
        showNotification('Please sign in first');
        return;
      }

      try {
        const expirationTime = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000);
        const payload = {
          description: profileDescription.value.trim() || 'YT Pro User',
          section: 'YT Pro',
          savedAt: new Date().toISOString(),
          app: 'BloxdForge',
          upgradedAt: new Date().toISOString(),
          proExpiration: expirationTime.toISOString()
        };

        await puter.fs.write(filenameForUser(), JSON.stringify(payload, null, 2));

        profileSection.value = 'YT Pro';
        applyVipStyle('YT Pro');

        if (authUserRank) {
          authUserRank.textContent = 'YT Pro';
          authUserRank.style.color = '#ff0000'; 
          authUserRank.className = 'auth-user-rank yt-pro';
          authUserRank.style.display = 'block';
        }

        if (CURRENT_USER) {
          CURRENT_USER.userType = 'YT Pro';
          CURRENT_USER.proExpiration = expirationTime.toISOString();
          saveToLocalStorage('bloxdforge-user', CURRENT_USER);
        }

        manageAdsForUserType('Pro'); 

        profileForm.style.display = 'none';
        profileData.style.display = 'block';
        profileData.innerHTML = `Description: ${payload.description}\nAccount Type: YT Pro (Expires in 1 month)\n\n<button class="auth-btn" onclick="showEditForm()">Edit Profile</button>`;

        showNotification('🎉 Congratulations! You are now a YT Pro user for 1 month!');

      } catch (e) {
        showNotification('Error upgrading to YT Pro');
        console.error(e);
      }
    }

    async function loadProfileFile() {
      if (!CURRENT_USER?.username) {
        showNotification('Please sign in first');
        return;
      }

      try {
        const blob = await puter.fs.read(filenameForUser());
        const text = await blob.text();

        try {
          const obj = JSON.parse(text);
          if (obj.description && obj.section) {
            let userSection = obj.section;
            if ((obj.section === 'Pro' || obj.section === 'YT Pro') && obj.proExpiration) {
              if (obj.proExpiration === 'forever') {
                userSection = obj.section; 
              } else {
                const expirationTime = new Date(obj.proExpiration);
                if (Date.now() > expirationTime.getTime()) {
                  userSection = 'Free';
                  showNotification('Your Pro status has expired. You have been downgraded to Free.');
                }
              }
            }

            profileForm.style.display = 'none';

            applyVipStyle(userSection);
            updateUserRank(userSection);

            if (CURRENT_USER) {
              CURRENT_USER.userType = userSection;
              if (obj.proExpiration && (userSection === 'Pro' || userSection === 'YT Pro')) {
                CURRENT_USER.proExpiration = obj.proExpiration;
              } else {
                delete CURRENT_USER.proExpiration;
              }
              saveToLocalStorage('bloxdforge-user', CURRENT_USER);
            }

            manageAdsForUserType(userSection);

            let expirationText = '';
            if ((userSection === 'Pro' || userSection === 'YT Pro') && obj.proExpiration) {
              if (obj.proExpiration === 'forever') {
                expirationText = ' (Forever)';
              } else {
                const expirationTime = new Date(obj.proExpiration);
                const timeLeft = Math.max(0, Math.floor((expirationTime.getTime() - Date.now()) / (1000 * 60)));
                expirationText = ` (Expires in ${timeLeft} minutes)`;
              }
            }
            profileData.style.display = 'block';
            profileData.innerHTML = `Description: ${obj.description}\nAccount Type: ${userSection}${expirationText}\n\n<button class="auth-btn" onclick="showEditForm()">Edit Profile</button>`;

            showNotification('Profile loaded successfully!');
          } else {
            profileForm.style.display = 'block';
            profileDescription.disabled = false;
            profileSection.disabled = false;
            saveProfileBtn.disabled = false;
            loadProfileBtn.disabled = false;

            if (obj.description) profileDescription.value = obj.description;
            if (obj.section) {
              let userSection = obj.section;
              if ((obj.section === 'Pro' || obj.section === 'YT Pro') && obj.proExpiration) {
                if (obj.proExpiration === 'forever') {
                  userSection = obj.section;
                } else {
                  const expirationTime = new Date(obj.proExpiration);
                  if (Date.now() > expirationTime.getTime()) {
                    userSection = 'Free';
                  }
                }
              }

              profileSection.value = userSection;
              applyVipStyle(userSection);
              updateUserRank(userSection);

              if (CURRENT_USER) {
                CURRENT_USER.userType = userSection;
                if (obj.proExpiration && (userSection === 'Pro' || userSection === 'YT Pro')) {
                  CURRENT_USER.proExpiration = obj.proExpiration;
                } else {
                  delete CURRENT_USER.proExpiration;
                }
                saveToLocalStorage('bloxdforge-user', CURRENT_USER);
              }

              manageAdsForUserType(userSection);

              let expirationText = '';
              if ((userSection === 'Pro' || userSection === 'YT Pro') && obj.proExpiration) {
                if (obj.proExpiration === 'forever') {
                  expirationText = ' (Forever)';
                } else {
                  const expirationTime = new Date(obj.proExpiration);
                  const timeLeft = Math.max(0, Math.floor((expirationTime.getTime() - Date.now()) / (1000 * 60)));
                  expirationText = ` (Expires in ${timeLeft} minutes)`;
                }
              }
              profileData.style.display = 'block';
              profileData.innerHTML = `Description: ${obj.description}\nAccount Type: ${userSection}${expirationText}\n\n<button class="auth-btn" onclick="showEditForm()">Edit Profile</button>`;

              showNotification('Profile loaded successfully!');
            } else {
              profileForm.style.display = 'block';
              profileDescription.disabled = false;
              profileSection.disabled = false;
              saveProfileBtn.disabled = false;
              loadProfileBtn.disabled = false;

              profileData.style.display = 'block';
              let profileText = 'Profile incomplete. Please update your information.';
              if ((userSection === 'Pro' || userSection === 'YT Pro') && obj.proExpiration) {
                if (obj.proExpiration === 'forever') {
                  profileText += '\nPro status: Forever';
                } else {
                  const expirationTime = new Date(obj.proExpiration);
                  const timeLeft = Math.max(0, Math.floor((expirationTime.getTime() - Date.now()) / (1000 * 60)));
                  profileText += `\nPro status expires in ${timeLeft} minutes.`;
                }
              }
              profileData.textContent = profileText;
            }
          }
        } catch (parseError) {
          profileForm.style.display = 'block';
          profileDescription.disabled = false;
          profileSection.disabled = false;
          saveProfileBtn.disabled = false;
          loadProfileBtn.disabled = false;

          profileData.style.display = 'block';
          profileData.textContent = 'Error loading profile data.';
          console.error('Error parsing profile data:', parseError);
        }
      } catch (e) {
        profileForm.style.display = 'block';
        profileDescription.disabled = false;
        profileSection.disabled = false;
        saveProfileBtn.disabled = false;
        loadProfileBtn.disabled = false;

        profileData.style.display = 'block';
        profileData.textContent = 'No saved profile found.';
        profileDescription.value = '';
        profileSection.value = 'Free';
        authAvatar.classList.remove('vip');
        authUserRank.style.display = 'none';
      }
    }

    signInBtn.addEventListener('click', async () => {
      try {
        const user = await puter.auth.signIn();
        let userData = user;

        if (!user?.username) {
          if (typeof puter.auth.getUserData === 'function') {
            userData = await puter.auth.getUserData();
          } else if (typeof puter.auth.getUser === 'function') {
            userData = await puter.auth.getUser();
          }
        }

        await setSignedIn(userData || user);
      } catch (e) {
        showNotification('Sign in failed');
        console.error(e);
      }
    });

    signOutBtn.addEventListener('click', async () => {
      try {
        if (typeof puter.auth.signOut === 'function') {
          await puter.auth.signOut();
        }
      } catch (e) {
        console.error('Sign out error:', e);
      }

      setSignedIn(null);
      showNotification('Signed out successfully');
    });

    saveProfileBtn.addEventListener('click', saveProfileFile);
    loadProfileBtn.addEventListener('click', loadProfileFile);

    profileSection.addEventListener('change', (e) => {
      applyVipStyle(e.target.value);
      updateUserRank(e.target.value);
      manageAdsForUserType(e.target.value);
    });

    authMenuBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      const authPopup = document.getElementById('auth-popup');
      const isOpen = authPopup.style.display === 'flex';

      if (isOpen) {
        authPopup.style.display = 'none';
        authMenuBtn.classList.remove('active');
      } else {
        authPopup.style.display = 'flex';
        authMenuBtn.classList.add('active');
      }
    });

    document.getElementById('auth-popup-close').addEventListener('click', () => {
      document.getElementById('auth-popup').style.display = 'none';
      authMenuBtn.classList.remove('active');
    });

    document.getElementById('auth-popup').addEventListener('click', (e) => {
      if (e.target.id === 'auth-popup') {
        e.target.style.display = 'none';
        authMenuBtn.classList.remove('active');
      }
    });

    window.addEventListener('message', function (event) {
      if (event.data && event.data.source === 'upgrade-page') {
        if (event.data.action === 'upgradeToPro') {
          upgradeUserToPro();
        } else if (event.data.action === 'upgradeToProForever') {
          upgradeUserToProForever();
        } else if (event.data.action === 'closeUpgrade') {
          const upgradeFrame = document.getElementById('upgrade-frame');
          if (upgradeFrame) {
            upgradeFrame.remove();
          }
        }
      }
    });

    if (upgradeProBtn) {
      upgradeProBtn.addEventListener('click', function () {
        if (!CURRENT_USER?.username) {
          showNotification('Please sign in first');
          return;
        }

        const upgradeFrame = document.createElement('iframe');
        upgradeFrame.id = 'upgrade-frame';
        upgradeFrame.src = './assets/upgrade-pro.html';
        upgradeFrame.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          border: none;
          z-index: 10000;
          background: #1b1a1a;
        `;

        document.body.appendChild(upgradeFrame);

        const closeBtn = document.createElement('button');
        closeBtn.innerHTML = '×';
        closeBtn.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 10001;
          background: #ff6b39;
          color: white;
          border: none;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          font-size: 24px;
          cursor: pointer;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `;

        closeBtn.addEventListener('click', function () {
          upgradeFrame.remove();
          closeBtn.remove();
        });

        document.body.appendChild(closeBtn);
      });
    }

    document.getElementById('open-upgrade-btn').addEventListener('click', function () {
      if (!CURRENT_USER?.username) {
        showNotification('Please sign in first');
        return;
      }

      const upgradeFrame = document.createElement('iframe');
      upgradeFrame.id = 'upgrade-frame';
      upgradeFrame.src = './assets/upgrade-pro.html';
      upgradeFrame.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        border: none;
        z-index: 10000;
        background: #1b1a1a;
      `;

      document.body.appendChild(upgradeFrame);

      const closeBtn = document.createElement('button');
      closeBtn.innerHTML = '×';
      closeBtn.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10001;
        background: #ff6b39;
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      `;

      closeBtn.addEventListener('click', function () {
        upgradeFrame.remove();
        closeBtn.remove();
      });

      document.body.appendChild(closeBtn);
    });

    document.getElementById('redeem-code-btn').addEventListener('click', function () {
      const codeInput = document.getElementById('code-input');
      const codeMessage = document.getElementById('code-message');
      const code = codeInput.value.trim(); 

      codeMessage.textContent = '';
      codeMessage.className = '';

      if (!code) {
        codeMessage.textContent = 'Please enter a code';
        codeMessage.className = 'error';
        return;
      }

      const validCodes = {
        'ILF67': { type: 'pro_forever', description: 'Pro status forever' },
        'Bf-7': { type: 'pro_week', description: 'Pro status for 1 week' },
        'CAT': { type: 'image', imageUrl: './assets/data/img/cat.png' },
        'FEMBOYS': { type: 'image', imageUrl: 'https://i.pinimg.com/originals/48/fa/45/48fa45e3d81916b3a198551e4dc0326b.jpg' },
        'YTUBE': { type: 'yt_pro_month', description: 'YT Pro status for 1 month' } 
      };

      const codeKeys = Object.keys(validCodes);
      const matchingCodeKey = codeKeys.find(key => key.toUpperCase() === code.toUpperCase());

      if (matchingCodeKey) {
        const codeData = validCodes[matchingCodeKey];

        if (codeData.type === 'pro_forever') {
          upgradeUserToProForever();
          codeMessage.textContent = 'Code redeemed successfully! You now have Pro status forever.';
          codeMessage.className = 'success';
        } else if (codeData.type === 'pro_week') {
          upgradeUserToProWeek();
          codeMessage.textContent = 'Code redeemed successfully! You now have Pro status for 1 week.';
          codeMessage.className = 'success';
        } else if (codeData.type === 'yt_pro_month') {

          upgradeUserToYTPro();
          codeMessage.textContent = 'Code redeemed successfully! You now have YT Pro status for 1 month.';
          codeMessage.className = 'success';
        } else if (codeData.type === 'image') {
          showPopupImage(codeData.imageUrl);
          codeMessage.textContent = 'Code redeemed successfully! Check out your reward.';
          codeMessage.className = 'success';
        }
      } else {
        codeMessage.textContent = 'Invalid code. Please try again.';
        codeMessage.className = 'error';
      }

      codeInput.value = '';
    });

    function showPopupImage(imageUrl) {
      const popup = document.createElement('div');
      popup.id = 'image-popup';
      popup.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10002;
      `;

      const popupContent = document.createElement('div');
      popupContent.style.cssText = `
        position: relative;
        max-width: 90%;
        max-height: 90%;
      `;

      const closeBtn = document.createElement('button');
      closeBtn.innerHTML = '×';
      closeBtn.style.cssText = `
        position: absolute;
        top: -40px;
        right: 0;
        background: #ff6b39;
        color: white;
        border: none;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        font-size: 1.2rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      `;

      const img = document.createElement('img');
      img.src = imageUrl;
      img.style.cssText = `
        max-width: 100%;
        max-height: 80vh;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      `;

      closeBtn.addEventListener('click', function () {
        popup.remove();
      });

      popup.addEventListener('click', function (e) {
        if (e.target === popup) {
          popup.remove();
        }
      });

      popupContent.appendChild(closeBtn);
      popupContent.appendChild(img);
      popup.appendChild(popupContent);
      document.body.appendChild(popup);
    }

    async function initializeAuth() {
      const storedUser = loadFromLocalStorage('bloxdforge-user');
      if (storedUser) {
        if (storedUser.userType === 'Pro' && storedUser.proExpiration) {
          if (storedUser.proExpiration !== 'forever') {
            const expirationTime = new Date(storedUser.proExpiration);
            if (Date.now() > expirationTime.getTime()) {
              storedUser.userType = 'Free';
              delete storedUser.proExpiration;
              saveToLocalStorage('bloxdforge-user', storedUser);
            }
          }
        }

        await setSignedIn(storedUser);
        setTimeout(() => {
          const initialUserType = getCurrentUserType();
          console.log('Initial user type after auth:', initialUserType);
          manageAdsForUserType(initialUserType);
        }, 100);
      } else {
        setSignedIn(null);
        manageAdsForUserType('Free');
      }
    }

    initializeAuth();

    setInterval(() => {
      if (CURRENT_USER && (CURRENT_USER.userType === 'Pro' || CURRENT_USER.userType === 'YT Pro') && CURRENT_USER.proExpiration) {
        if (CURRENT_USER.proExpiration === 'forever') {
          return;
        }

        const expirationTime = new Date(CURRENT_USER.proExpiration);
        if (Date.now() > expirationTime.getTime()) {
          CURRENT_USER.userType = 'Free';
          delete CURRENT_USER.proExpiration;
          saveToLocalStorage('bloxdforge-user', CURRENT_USER);
          updateUserRank('Free');
          manageAdsForUserType('Free');
          showNotification('Your Pro status has expired. You have been downgraded to Free.');
        } else {

          updateUserRank(CURRENT_USER.userType === 'YT Pro' ? 'YT Pro' : 'Pro');
        }
      }
    }, 60000);

    const cards = document.querySelectorAll('.card');
    const homeBtn = document.querySelector('.long-btn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const iframe = document.getElementById('contentFrame');
    const notification = document.getElementById('notification');

    setTimeout(() => {
      notification.classList.add('show');
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }, 500);

    cards.forEach(card => {
      card.addEventListener('click', () => {
        const url = card.getAttribute('data-url');

        console.log('Adding blur effect to iframe');
        iframe.classList.add('blurred');
        console.log('Iframe classes after adding blur:', iframe.className);

        setTimeout(() => {
          console.log('Removing blur effect from iframe');
          iframe.classList.remove('blurred');
          console.log('Iframe classes after removing blur:', iframe.className);
        }, 500);

        const currentUserType = getCurrentUserType();
        console.log('Card clicked, user type:', currentUserType);

        manageAdsForUserType(currentUserType);

        setTimeout(() => {
          iframe.src = url;
          iframe.onload = () => {
            const currentUserType = getCurrentUserType();
            try {
              iframe.contentWindow.postMessage({
                action: (currentUserType === 'Pro' || currentUserType === 'YT Pro') ? 'hideAds' : 'showAds',
                userType: currentUserType
              }, '*');
            } catch (e) {
              console.log('Could not communicate with iframe:', e);
            }

            manageAdsForUserType(currentUserType);
          };

          cards.forEach(c => c.classList.remove('active-card'));
          homeBtn.classList.remove('active-btn');

          card.classList.add('active-card');
        });
      });
    });

    homeBtn.addEventListener('click', () => {
      const url = homeBtn.getAttribute('data-url');

      console.log('Adding blur effect to iframe (home button)');
      iframe.classList.add('blurred');
      console.log('Iframe classes after adding blur:', iframe.className);

      setTimeout(() => {
        console.log('Removing blur effect from iframe (home button)');
        iframe.classList.remove('blurred');
        console.log('Iframe classes after removing blur:', iframe.className);
      }, 500);

      const currentUserType = getCurrentUserType();
      console.log('Home button clicked, user type:', currentUserType);

      manageAdsForUserType(currentUserType);

      iframe.src = url;
      iframe.onload = () => {
        const currentUserType = getCurrentUserType();
        try {
          iframe.contentWindow.postMessage({
            action: (currentUserType === 'Pro' || currentUserType === 'YT Pro') ? 'hideAds' : 'showAds',
            userType: currentUserType
          }, '*');
        } catch (e) {
          console.log('Could not communicate with iframe:', e);
        }

        manageAdsForUserType(currentUserType);
      };

      cards.forEach(c => c.classList.remove('active-card'));

      homeBtn.classList.add('active-btn');
    });

    fullscreenBtn.addEventListener('click', () => {
      if (!document.fullscreenElement) {
        iframe.requestFullscreen().catch(err => {
          showNotification('Fullscreen failed: ' + err.message);
        });
      } else {
        document.exitFullscreen();
      }
    });

    function showNotification(message) {
      notification.textContent = message;
      notification.classList.add('show');

      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    if (localStorage.getItem("popupinfo")) {
      document.getElementById("popupinfo").style.display = "none";
    }

    document.getElementById("closePopup").addEventListener("click", () => {
      document.getElementById("popupinfo").style.display = "none";
      localStorage.setItem("popupinfo", Date.now());
    });

    function initShowPop() {
      const showpop = document.getElementById('showpop');
      const showpopClose = document.getElementById('showpopClose');
      const showpopDismiss = document.getElementById('showpopDismiss');
      const showpopTry = document.getElementById('showpopTry');

      if (!localStorage.getItem('showpopDismissed')) {
        setTimeout(() => {
          showpop.classList.add('show');
        }, 5000);
      }

      showpopClose.addEventListener('click', () => {
        showpop.classList.remove('show');
      });

      showpopDismiss.addEventListener('click', () => {
        showpop.classList.remove('show');
        localStorage.setItem('showpopDismissed', Date.now());
      });

      showpopTry.addEventListener('click', () => {
        showpop.classList.remove('show');
        if (CURRENT_USER?.username) {
          const upgradeFrame = document.createElement('iframe');
          upgradeFrame.id = 'upgrade-frame';
          upgradeFrame.src = './assets/upgrade-pro.html';
          upgradeFrame.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            border: none;
            z-index: 10000;
            background: #1b1a1a;
          `;

          document.body.appendChild(upgradeFrame);

          const closeBtn = document.createElement('button');
          closeBtn.innerHTML = '×';
          closeBtn.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10001;
            background: #ff6b39;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          `;

          closeBtn.addEventListener('click', function () {
            upgradeFrame.remove();
            closeBtn.remove();
          });

          document.body.appendChild(closeBtn);
        } else {
          showNotification('Please sign in first to upgrade to Pro');
          const authPopup = document.getElementById('auth-popup');
          if (authPopup.style.display !== 'flex') {
            authPopup.style.display = 'flex';
            authMenuBtn.classList.add('active');
          }
        }
      });
    }

    initShowPop();

    document.addEventListener('click', (e) => {
      const authPopup = document.getElementById('auth-popup');
      if (authPopup.style.display === 'flex' &&
        !authPopup.contains(e.target) &&
        !authUserInfo.contains(e.target)) {
        authPopup.style.display = 'none';
        authMenuBtn.classList.remove('active');
      }
    });

    document.querySelectorAll('.tab-btn').forEach(button => {
      button.addEventListener('click', () => {

        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));

        button.classList.add('active');

        const tabId = button.getAttribute('data-tab');
        document.getElementById(`${tabId}-tab`).classList.add('active');
      });
    });
  </script>
</body>

</html>